# VULCA Prototype è®¡åˆ’ v2.0

> åŸºäº v1.1 å®è¯å¤ç›˜ + æ·±åº¦å®¡è®¡ + è·¯çº¿å¤æ ¸ + Agent çœŸç›¸åˆ†æï¼Œå‡çº§ä¸º L1-L5 æ·±åº¦é©±åŠ¨ç‰ˆæœ¬
> æ—¥æœŸï¼š2026-02-12ï¼ˆv2.5 åŒæ­¥ â€” å…¨é‡ GPU çœŸå®æ¨ç†éªŒè¯å®Œæˆï¼‰
> å‰ç½®çŠ¶æ€ï¼šv1.1 å·¥ç¨‹é—­ç¯å·²è·‘é€šï¼ˆ323+ è‡ªåŠ¨æ£€æŸ¥ï¼‰ï¼ŒStep 2 Together FLUX çœŸå®æ”¾é‡å·²éªŒè¯ï¼ˆ320 tasks, 90% pass, P95 ~10.7s, $0.0132/taskï¼‰
> ç›®æ ‡ï¼šå°† L1-L5 è®¤çŸ¥æ¡†æ¶ä»"è¯„åˆ†æ ‡ç­¾"å‡çº§ä¸º"å…¨é“¾è·¯é©±åŠ¨å¼•æ“"
>
> **v2.3 åŒæ­¥è¯´æ˜**ï¼š
> - æ¨¡å‹è·¯çº¿ä¿æŒï¼šClaude Sonnet ($0.02) â†’ **DeepSeek V3.2** ($0.002) + **Gemini Flash-Lite** ($0.001)
> - ä¸»é“¾å®å†µï¼šå½“å‰è¿è¡Œé“¾è·¯ä»æ˜¯è§„åˆ™ç¼–æ’ï¼ˆCritic/Queen è§„åˆ™é€»è¾‘ï¼‰
> - å·²è½åœ°åŸºç¡€è®¾æ–½ï¼šLayerState / IntentCardV2 / ToolRegistry / ModelRouter / AgentRuntimeï¼ˆä½†å°šæœªæ¥å…¥ä¸»é“¾ï¼‰
> - å…³é”®æœªå®Œæˆï¼š`critic_llm.py`ã€AgentRuntime æ¥çº¿ã€LLM tools é€ä¼ ã€LLM è¯„å®¡éªŒè¯è„šæœ¬
> - æˆæœ¬å£å¾„ï¼š$0.008/æ ·ä¾‹å±äºç›®æ ‡ä¼°ç®—ï¼Œéœ€ä»¥çœŸå® token è´¦å•å¤æ ¸

---

## -1. è§‚æµ‹åŒæ­¥ï¼ˆ2026-02-12ï¼Œä»£ç å®å†µ â€” æ ¸å¿ƒ+è¿›é˜¶+å…¨é‡æ¨¡å‹éƒ¨ç½²+**GPU çœŸå®æ¨ç†éªŒè¯** å®Œæˆï¼‰

| è§‚æµ‹é¡¹ | å½“å‰çŠ¶æ€ | ä»£ç è¯æ® |
|-------|---------|---------|
| ä¸»æ‰§è¡Œé“¾æ˜¯å¦å¯é€‰ ReAct Agent | âœ… **æ˜¯**ï¼ˆ`enable_agent_critic=True`ï¼‰ | `orchestrator.py` â†’ `CriticLLM` â†’ `AgentRuntime` å…¨é“¾è·¯ |
| Critic æ˜¯å¦ LLM é©±åŠ¨ | âœ… **å¯é€‰æ··åˆ**ï¼ˆè§„åˆ™ + Agentï¼‰ | `agents/critic_llm.py`ï¼ˆ~260 è¡Œï¼‰ï¼Œ28/28 mock + 25/25 with-LLM |
| Agent åŸºç¡€è®¾æ–½æ˜¯å¦å­˜åœ¨ | âœ… å…¨éƒ¨è½åœ° | `agent_runtime.py` / `tool_registry.py` / `model_router.py` / `layer_state.py` |
| Agent åŸºç¡€è®¾æ–½æ˜¯å¦æ¥å…¥ä¸»é“¾ | âœ… **å·²æ¥å…¥** | `orchestrator.py` é€šè¿‡ `enable_agent_critic` è°ƒç”¨ `CriticLLM` |
| `critic_llm.py` | âœ… **å·²åˆ›å»ºå¹¶éªŒè¯** | `agents/critic_llm.py`ï¼ˆ~260 è¡Œï¼‰ |
| Function Calling é—­ç¯ | âœ… **å·²æ‰“é€š** | `agent_runtime.py` ä¼  `tools=all_schemas()`ï¼ŒLLM tool_calls â†’ æ‰§è¡Œ â†’ å†™å› LayerState |
| å±€éƒ¨é‡ç»˜ï¼ˆinpaintingï¼‰ | âœ… **GPU éªŒè¯é€šè¿‡** | SD 1.5 GPU **30/30 PASS** (~3.7s@512x512, fp16, ~2GB VRAM) |
| IP-Adapter é£æ ¼è¿ç§» | âœ… **GPU éªŒè¯é€šè¿‡**ï¼ˆ2026-02-12ï¼‰ | ä¿®å¤ attention_slicing å†²çªï¼Œ**13/13 GPU PASS** (~43s) |
| ControlNet canny/depth | âœ… **GPU éªŒè¯é€šè¿‡**ï¼ˆ2026-02-12ï¼‰ | canny+depth åŒæ¨¡å¼ï¼Œ**26/26 GPU PASS** |
| CLIP ViT-B/32 è§†è§‰æ£€ç´¢ | âœ… **åœ¨çº¿** | `faiss_index_service.py:_lazy_init_clip()` + `scout_service.py:search_visual_references()`ï¼ŒRecall@5=93.33%ï¼Œ17/17 éªŒè¯ |
| Scout FAISS è¯­ä¹‰æ£€ç´¢ | âœ… **Phase B å·²å®Œæˆ** | `agents/faiss_index_service.py` + `scout_service.py:search_mode`ï¼Œall-MiniLM-L6-v2 + IndexFlatIPï¼ŒRecall@5=100% |
| æ–‡åŒ–è·¯ç”± | âœ… **Phase D å·²å®Œæˆ** | `cultural_pipelines/pipeline_router.py`ï¼Œ9 ä¼ ç»Ÿæƒé‡è¡¨ + 3 ç®¡é“å˜ä½“ï¼Œorchestrator é›†æˆï¼Œ96/96 Gate D |
| è·¨å±‚ä¿¡å·ï¼ˆCrossLayerSignalï¼‰ | âœ… **å·²å®ç°**ï¼ˆ2026-02-10ï¼‰ | `critic_llm.py:_detect_cross_layer_signals()` 5 æ¡è§„åˆ™ â†’ Queen `_decide_action` 5bæ¶ˆè´¹ï¼Œ22/22 éªŒè¯ |
| åŠ¨æ€æƒé‡ | âœ… **å·²å®ç°**ï¼ˆ2026-02-10ï¼‰ | `dynamic_weights.py:compute_dynamic_weights()` 4 æ­¥è°ƒåˆ¶ + orchestrator é›†æˆï¼Œ34/34 éªŒè¯ |
| æ¸è¿›æ·±åŒ–ï¼ˆL1â†’L5 ä¸²è¡Œï¼‰ | âœ… **å·²å®ç°**ï¼ˆ2026-02-10ï¼‰ | `critic_llm.py:_escalate_serial()` + `accumulated_context` è·¨å±‚ä¼ é€’ï¼Œ38/38 éªŒè¯ |
| L1/L2 VLM Agent | âœ… **å·²å®ç°**ï¼ˆ2026-02-10ï¼‰ | `critic_llm.py:_build_user_message` multimodal + `_encode_image_content` base64ï¼Œ26/26 éªŒè¯ |
| GalleryGPT ç»˜ç”» VLM | âœ… **GPU éªŒè¯é€šè¿‡**ï¼ˆ2026-02-12ï¼‰ | LLaVA 1.5 7B 4-bit NF4ï¼Œ**34/35 GPU PASS**ï¼ˆ4327MB VRAMï¼Œ~78sï¼‰ |
| KOALA-Lightning 700M | âœ… **GPU éªŒè¯é€šè¿‡**ï¼ˆ2026-02-12ï¼‰ | SDXL 1024Ã—1024 10æ­¥ï¼Œ**16/16 GPU PASS**ï¼ˆ5692MB VRAMï¼Œ~200sï¼‰ |
| API æ¨¡å‹è¿æ¥ | âœ… 3/4 åœ¨çº¿ | DeepSeek V3.2 (1812ms) + Gemini Flash-Lite (738ms) + Together.ai FLUX (1593ms)ï¼›âŒ GPT-4o-mini key è¿‡æœŸ |
| **WSL2 GPU ç¯å¢ƒ** | âœ… **å·²ä¿®å¤**ï¼ˆ2026-02-12ï¼‰ | NVIDIA 572.83 + CUDA 12.8 + TDR=60sï¼Œ**5/5 GPU æ¨¡å‹å…¨éƒ¨çœŸå®æ¨ç†é€šè¿‡** |
| crewai/langgraph åœ¨ prototype ä¸»é“¾ä½¿ç”¨ | å¦ | ä»…ä¾èµ–å£°æ˜ï¼Œ`app/prototype` æ— ä¸»é“¾ import/use |

> ç»“è®ºï¼š**Phase A-D æ ¸å¿ƒ + è¿›é˜¶å››é¡¹ + å…¨é‡æ¨¡å‹éƒ¨ç½² + GPU çœŸå®æ¨ç†éªŒè¯ å…¨éƒ¨å®Œæˆ**ã€‚
> ç³»ç»Ÿä»"çº¯è§„åˆ™ç®¡é“"å‡çº§ä¸º"è§„åˆ™+Agentæ··åˆç®¡é“+å±€éƒ¨é‡ç»˜+ControlNetæ¡ä»¶æ§åˆ¶+IP-Adapteré£æ ¼è¿ç§»+FAISS+CLIPè¯­ä¹‰é”šå®š+æ–‡åŒ–è·¯ç”±+L1-L5åŠ¨æ€èåˆ"ã€‚
> **æ‰€æœ‰ 5 ä¸ªæœ¬åœ° GPU æ¨¡å‹ï¼ˆSD 1.5 / ControlNet / IP-Adapter / GalleryGPT / KOALAï¼‰å‡å·²é€šè¿‡çœŸå® GPU æ¨ç†éªŒè¯**ã€‚
> E2E å›å½’ 60/60 é€šè¿‡ï¼ˆ20 æ ·ä¾‹ Ã— 3 å˜ä½“ï¼‰ï¼ŒP95=6.8sï¼Œ$0.00ã€‚éªŒè¯è„šæœ¬æ€»æ•°ï¼š36 ä¸ªã€‚
> å‰©ä½™å·®è·ï¼ˆ~4%ï¼‰ï¼šGPT-4o-mini key æ›´æ–°ã€Langfuse è§‚æµ‹ã€ç›²è¯„å®éªŒã€å‰ç«¯ Critic è¯¦æƒ…é¡µã€‚

---

## 0. v1.1 å¤ç›˜ï¼šåšåˆ°äº†ä»€ä¹ˆã€ç¼ºäº†ä»€ä¹ˆ

### å·²å®Œæˆï¼ˆä¿ç•™ï¼‰
- Pipeline éª¨æ¶ï¼šScout â†’ Draft â†’ Critic â†’ Queen â†’ Archivist 5 é˜¶æ®µè·‘é€š
- HITL äººç±»åœ¨ç¯ï¼š5 ä¸ªåŠ¨ä½œï¼ˆapprove/reject/rerun/lock_dimensions/force_acceptï¼‰
- ç»´åº¦é”å®šä¸å±€éƒ¨é‡è·‘ï¼šCritic åˆ†æ•°ä¿ç•™æœºåˆ¶çœŸå®æœ‰æ•ˆ
- é¢„ç®—æ§åˆ¶ï¼šQueen 8 çº§å†³ç­–å±‚æ¬¡ + æˆæœ¬ä¸Šé™
- å…¨æ ˆè”é€šï¼šå‰ç«¯ SSE + åç«¯ API + Checkpoint æŒä¹…åŒ–
- æµ‹è¯•è¦†ç›–ï¼š323+ è‡ªåŠ¨åŒ–æ£€æŸ¥ï¼Œ48 orchestrator / 18 API / 35 E2E

### æ ¸å¿ƒå·®è·ï¼ˆv2 è§£å†³ï¼‰

> **ä¿®æ­£è¯´æ˜**ï¼ˆåŸºäºæ·±åº¦å®¡è®¡ 2026-02-10ï¼‰ï¼š
> - å¹¶é"å…¨ mock"ï¼šStep 2 å·²å®Œæˆ Together FLUX çœŸå®æ”¾é‡éªŒè¯ï¼ˆ320 tasks, 90% pass, $0.0132/taskï¼‰
> - å¹¶é"å®Œå…¨æ— é”šå®š"ï¼šå·²æœ‰æœ¯è¯­è¯å…¸ã€ç¦åŒºè§„åˆ™ã€æ ·æœ¬åŒ¹é…ï¼ˆJaccard/tagï¼‰ï¼Œä½†ä¸æ˜¯å‘é‡è¯­ä¹‰æ£€ç´¢
> - Critic æš‚ä¸å‡çº§æ˜¯æœ‰æ„å†³ç­–ï¼ˆæˆæœ¬æ§åˆ¶ï¼‰ï¼Œä¸æ˜¯é—æ¼

| å·®è· | ä¸¥é‡åº¦ | ç°çŠ¶ | v2 ç›®æ ‡ |
|------|--------|------|---------|
| **Critic ä¸ºè§„åˆ™æ‰“åˆ†** â€” æ—  LLM/VLM è¯„å®¡ | ğŸ”´ è‡´å‘½ | è§„åˆ™åŒ–ç¡®å®šæ€§è¯„åˆ† | æ··åˆæ¨¡å¼ï¼šè§„åˆ™ç¡¬é—¨ç¦ + LLM L3-L5 é€‰æ‹©æ€§å‡çº§ |
| **Draft æ— æœ¬åœ°ç”Ÿæˆ** â€” ä»… Mock + FLUX API | ğŸŸ  ä¸¥é‡ | FLUX å·²éªŒè¯å¯ç”¨ | ComfyUI æœ¬åœ° SD 1.5 + ControlNet å±€éƒ¨é‡ç»˜ |
| **L1-L5 åªåœ¨ Critic å‡ºç°** â€” å…¶ä»– Agent ä¸æ„ŸçŸ¥ | ğŸ”´ è‡´å‘½ | Critic 5 ç»´åº¦è¯„åˆ† | å…¨é“¾è·¯æ¯é˜¶æ®µ L é©±åŠ¨ |
| **æ— å±€éƒ¨é‡ç»˜** â€” Rerun = å…¨é‡æ–°å›¾ | ğŸŸ  ä¸¥é‡ | åˆ†æ•°ä¿ç•™ + æ–°å›¾å†ç”Ÿ | ComfyUI inpaint + mask åƒç´ çº§å±€éƒ¨ä¿®æ”¹ |
| **æ— æ–‡åŒ–è·¯ç”±** â€” æ‰€æœ‰ä¼ ç»Ÿèµ°åŒä¸€ç®¡é“ | ğŸŸ¡ é‡è¦ | ä»…ä¼  `tradition` å‚æ•° | 3 æ¡å·®å¼‚åŒ–ç®¡é“ï¼ˆæƒé‡+æµç¨‹ï¼‰ |
| **Scout è¯­ä¹‰æ£€ç´¢å¼±** â€” è§„åˆ™/Jaccard åŒ¹é… | ğŸŸ¡ é‡è¦ | æœ¯è¯­+ç¦åŒº+æ ·æœ¬(Jaccard) | CLIP + FAISS å‘é‡è¯­ä¹‰æ£€ç´¢ |
| **æ— è§‚æµ‹é“¾è·¯** â€” æ—  Langfuse/æˆæœ¬è¿½è¸ª | ğŸŸ¡ é‡è¦ | æ‰‹åŠ¨ç»Ÿè®¡ | Langfuse trace |

---

## 1. æ ¸å¿ƒå®šä½ï¼ˆå¼ºåŒ–ï¼‰

VULCA ä¸æ˜¯é€šç”¨æ–‡ç”Ÿå›¾ï¼Œè€Œæ˜¯**è·¨æ–‡åŒ–æ‰¹è¯„é©±åŠ¨ç”Ÿæˆç³»ç»Ÿ**ã€‚

**v2 æ–°å¢å®šä½**ï¼šL1-L5 ä¸æ˜¯äº”ä¸ªæ‰“åˆ†ç»´åº¦ï¼Œè€Œæ˜¯**äº”å±‚åŠ¨æ€è®¤çŸ¥å¼•æ“**ï¼Œ
é©±åŠ¨ç³»ç»Ÿçš„æ¯ä¸€ä¸ªé˜¶æ®µâ€”â€”ä»è¯æ®æ”¶é›†åˆ°å›¾åƒç”Ÿæˆåˆ°è¯„å®¡åé¦ˆã€‚
å±‚çº§ä¹‹é—´æœ‰ä¿¡æ¯æµåŠ¨ï¼ˆä¾èµ–é“¾ + åå“ºé“¾ï¼‰ï¼Œæƒé‡éšè®¤çŸ¥çŠ¶æ€åŠ¨æ€è°ƒæ•´ï¼Œ
æ¨¡æ‹Ÿäººç±»æ‰¹è¯„å®¶"å…ˆçœ‹å½¢å¼ã€å†ç†è§£æ–‡åŒ–ã€æœ€åä½“æ‚Ÿå“²å­¦ã€ç„¶åç”¨å“²å­¦æ´è§é‡æ–°å®¡è§†å½¢å¼"çš„è®¤çŸ¥å¾ªç¯ã€‚

> è¯¦è§ `vulca-l1l5-dynamic-fusion-design.md`ï¼ˆL1-L5 åŠ¨æ€èåˆæ¶æ„å®Œæ•´è®¾è®¡ï¼‰

```
L1 Visual Perception   çœ‹åˆ°ä»€ä¹ˆ   â†’ é©±åŠ¨æ„å›¾/è‰²å½©/å½¢å¼ç”Ÿæˆ
L2 Technical Analysis   æ€ä¹ˆåšçš„   â†’ é©±åŠ¨ç¬”æ³•/ææ–™/é€è§†æ¸²æŸ“
L3 Cultural Context     æ–‡åŒ–èƒŒæ™¯   â†’ é©±åŠ¨ç¬¦å·/å…¸æ•…/ä¼ ç»Ÿé€‰æ‹©
L4 Critical Interpret.  æ‰¹è¯„è§£è¯»   â†’ é©±åŠ¨è‰ºæœ¯å²å®šä½/æµæ´¾å¯¹æ¯”
L5 Philos. Aesthetic    æ·±å±‚æ„ä¹‰   â†’ é©±åŠ¨å“²å­¦é”šå®š/ç¾å­¦ç†å¿µ
```

ä¸‰ä¸ªä¸å˜çš„å–ç‚¹ï¼š
- **Cultural QA**ï¼šL3 æ–‡åŒ–è¯­å¢ƒå‰åæ ¡éªŒ
- **Cultural Guardrails**ï¼šL4/L5 ç¡¬é—¨ç¦ï¼Œé˜²æ­¢"æ¼‚äº®ä½†æ–‡åŒ–é”™è¯¯"
- **Cultural Provenance**ï¼šL1-L5 æ¯å±‚ç‹¬ç«‹è¯æ®é“¾å¯è¿½æº¯

---

## 2. L1-L5 é©±åŠ¨æ¶æ„ï¼ˆv2 æ ¸å¿ƒå‡çº§ï¼‰

### 2.0 åŠ¨æ€èåˆä¸‰å¤§æœºåˆ¶ â˜… å·®å¼‚åŒ–æ ¸å¿ƒ

> å®Œæ•´è®¾è®¡è§ `vulca-l1l5-dynamic-fusion-design.md`

L1-L5 ä¸æ˜¯ 5 ä¸ªç‹¬ç«‹ç»´åº¦çš„å¹³è¡Œè¯„åˆ†ï¼Œè€Œæ˜¯**5 å±‚é€’è¿›è®¤çŸ¥çš„åŠ¨æ€äº¤äº’**ï¼ˆåŸºäº Panofsky å›¾åƒå­¦å±‚çº§ä¾èµ–ï¼‰ï¼š

**æœºåˆ¶ä¸€ï¼šL å±‚åŠ¨æ€çŠ¶æ€æ¨¡å‹ï¼ˆLayerStateï¼‰**
- æ¯å±‚ä¸å†åªæœ‰ score + rationaleï¼Œè€Œæ˜¯å®Œæ•´çŠ¶æ€æœºï¼š
  `score / confidence / evidence_coverage / volatility / locked / escalated / cost_spent_usd / evidence_ids / insights`
- `priority = w Ã— (1-score) Ã— (1-confidence) Ã— risk` â€” é©±åŠ¨è°ƒåº¦å’Œå‡çº§

**æœºåˆ¶äºŒï¼šè·¨å±‚ä¿¡æ¯æµï¼ˆCross-Layer Information Flowï¼‰**
- ä¾èµ–é“¾ï¼ˆL1â†’L2â†’L3â†’L4â†’L5ï¼‰ï¼šä½å±‚å®Œæˆè§£é”é«˜å±‚è¯„å®¡
- åå“ºé“¾ï¼ˆL5â†’L2, L3â†’L1ï¼‰ï¼šé«˜å±‚æ´è§æ”¹å˜ä½å±‚è¯„ä»·
- 4 ç§ä¿¡å·ï¼š`reinterpret`ï¼ˆé‡æ–°è§£è¯»ï¼‰ã€`unlock`ï¼ˆè§£é”ï¼‰ã€`boost`ï¼ˆå¢å¼ºï¼‰ã€`suppress`ï¼ˆæŠ‘åˆ¶ï¼‰
- å‡çº§è§¦å‘ï¼š`priority > Ï„` æˆ– `judge_disagreement > Ï„` æˆ– `evidence_coverage < Ï„`

**æœºåˆ¶ä¸‰ï¼šåŠ¨æ€æƒé‡ä¸é¢„ç®—è°ƒåº¦**
```
åŠ¨æ€æƒé‡ = f(ä¼ ç»ŸåŸºçº¿, ç½®ä¿¡åº¦è°ƒåˆ¶, è·¨å±‚ä¿¡å·ç´¯ç§¯, è½®æ¬¡é€’è¿›)
é¢„ç®—åˆ†é… = B_remaining Ã— softmax(Î± Ã— priority_d)  â€” å‘å¼±å±‚å€¾æ–œ
```
- ç¡¬çº¦æŸï¼šä»»ä½•å±‚æœ€ä½ 5% æƒé‡ï¼Œå½’ä¸€åŒ–åˆ° 1.0
- é¢„ç®—æŒ‰å±‚åˆ†è´¦ï¼ŒQueen å¯çœ‹åˆ°"èŠ±äº†å¤šå°‘é’±åœ¨ L3 ä¸Š"

**æœºåˆ¶å››ï¼šå±€éƒ¨é‡ç»˜åè®®ï¼ˆLocalRerunRequestï¼‰** â˜… æ–°å¢
- `rerun_local`ï¼ˆå±€éƒ¨ä¿®æ”¹ï¼‰vs `rerun_global`ï¼ˆå…¨é‡é‡è·‘ï¼‰ä¸¤æ¡æ‰§è¡Œé“¾
- ä¸‰é¡¹ç¡¬æŒ‡æ ‡ï¼šé”å®šå±‚ä¿çœŸ â‰¥ 95% / è·¨ç»´æ¼‚ç§» â‰¤ 10% / æˆæœ¬æ¯” â‰¤ 35%

### 2.1 L1-L5 åœ¨æ¯ä¸ªé˜¶æ®µçš„èŒè´£

| é˜¶æ®µ | L1 Visual | L2 Technical | L3 Cultural | L4 Critical | L5 Aesthetic |
|------|-----------|-------------|-------------|-------------|-------------|
| **Scout** | æ£€ç´¢ç›¸ä¼¼æ„å›¾ | æ£€ç´¢åŒæŠ€æ³•ä½œå“ | æ£€ç´¢æ–‡åŒ–è¯æ®/æœ¯è¯­ | æ£€ç´¢æ‰¹è¯„æ–‡çŒ® | æ£€ç´¢å“²å­¦ç¾å­¦æºæµ |
| **Draft** | ç”Ÿæˆæ„å›¾è‰å›¾ | æ¸²æŸ“ç‰¹å®šç¬”æ³• | æ¤å…¥æ–‡åŒ–ç¬¦å· | â€” | ä½“ç°ç¾å­¦æ„å¢ƒ |
| **Critic** | VLM è§†è§‰åˆ†æ | VLM æŠ€æ³•å¯¹æ¯” | LLM+é”šå®šè¯„å®¡ | LLM æ‰¹è¯„è§£è¯» | LLM å“²å­¦æ·±åº¦è¯„å®¡ |
| **Refine** | æ„å›¾å¾®è°ƒ | ç¬”æ³•ä¿®æ­£ | ç¬¦å·å¢å‡ | å™äº‹è°ƒæ•´ | æ„å¢ƒæ·±åŒ– |
| **Queen** | åˆ¤æ–­è§†è§‰å®Œæˆåº¦ | åˆ¤æ–­æŠ€æ³•è¾¾æ ‡ | åˆ¤æ–­æ–‡åŒ–å‡†ç¡® | åˆ¤æ–­æ‰¹è¯„ç«‹ä½ | åˆ¤æ–­å“²å­¦åˆ°ä½ |

**åŠ¨æ€è¡Œä¸ºï¼ˆå„é˜¶æ®µæ ¸å¿ƒå·®å¼‚åŒ–ï¼‰**ï¼š
- **Scout**ï¼šåˆå§‹åŒ–è®¤çŸ¥çŠ¶æ€å›¾ï¼›L3 è¯æ®ä¸è¶³æ—¶**åŠ¨æ€æ‰©å±•æ£€ç´¢èŒƒå›´**
- **Draft**ï¼šé¦–è½® focus L1-L2ï¼ˆå…ˆç”»å¯¹ï¼‰ï¼Œåç»­è½®è¯»å–è®¤çŸ¥å›¾å¼±å±‚åŠ¨æ€è°ƒæ•´ prompt ç­–ç•¥ï¼›è·¨å±‚åå“ºä¿¡å·æ³¨å…¥ç”Ÿæˆä¸Šä¸‹æ–‡
- **Critic**ï¼š**æ¸è¿›æ·±åŒ–**ï¼ˆL1â†’L2â†’L3â†’L4â†’L5 ä¸²è¡Œï¼Œæ¯å±‚è¯»å–å‰å±‚å‘ç°ï¼‰+ **æ¡ä»¶åå“ºè½®**ï¼ˆL5/L3 çš„ reinterpret ä¿¡å·è§¦å‘ä½å±‚é‡è¯„ï¼‰
- **Queen**ï¼šè®¤çŸ¥å®Œæˆåº¦æ£€æŸ¥ â†’ åå“ºå†²çªæ£€æŸ¥ â†’ **å¼±å±‚æ¨¡å¼è¯†åˆ«**ï¼ˆsurface_weak/culture_weak/depth_weak/cross_layer_gapï¼‰â†’ ç­–ç•¥é€‰æ‹© + æ–‡åŒ–ç®¡é“è¦†ç›–
- **Refine**ï¼š**ä¿æŠ¤æ¸…å•**ï¼ˆé«˜ç½®ä¿¡ + å¥½åˆ†æ•°çš„å±‚ä¸æ”¹ï¼‰+ **å‰¯ä½œç”¨é¢„æµ‹**ï¼ˆä¿®æ”¹ä¸€å±‚å¯èƒ½å½±å“å·²ç¡®è®¤å±‚ï¼‰

### 2.2 L1-L5 é©±åŠ¨çš„è¯„åˆ†æƒé‡ï¼ˆæŒ‰æ–‡åŒ–ä¼ ç»Ÿå·®å¼‚åŒ–ï¼‰

| æ–‡åŒ–ä¼ ç»Ÿ | L1 | L2 | L3 | L4 | L5 | è®¾è®¡ç†ç”± |
|---------|----|----|----|----|-----|---------|
| ä¸­å›½å†™æ„ | 0.10 | 0.15 | 0.25 | 0.20 | **0.30** | å†™æ„é‡"æ„åœ¨ç¬”å…ˆ"ï¼ŒL5 å“²å­¦æœ€é‡ |
| ä¸­å›½å·¥ç¬” | 0.15 | **0.30** | 0.25 | 0.15 | 0.15 | å·¥ç¬”é‡æŠ€æ³•ç²¾ç»†åº¦ |
| è¥¿æ–¹å­¦é™¢æ´¾ | 0.20 | **0.25** | 0.15 | **0.25** | 0.15 | å­¦é™¢æ´¾é‡æŠ€æ³•+æ‰¹è¯„ä¼ ç»Ÿ |
| ä¼Šæ–¯å…°å‡ ä½• | **0.25** | **0.30** | 0.20 | 0.15 | 0.10 | å‡ ä½•é‡è§†è§‰ç²¾ç¡®+æŠ€æœ¯è§„èŒƒ |
| æ°´å½© | 0.20 | **0.25** | 0.15 | 0.20 | 0.20 | æ°´å½©é‡æŠ€æ³•ï¼ˆä¸å¯é€†ï¼‰+å‡è¡¡ |
| éæ´²ä¼ ç»Ÿ | 0.15 | 0.15 | **0.30** | 0.20 | 0.20 | æ–‡åŒ–è¯­å¢ƒæœ€å…³é”® |
| å—äºšä¼ ç»Ÿ | 0.15 | 0.15 | **0.30** | 0.15 | 0.25 | å®—æ•™æ–‡åŒ–è¯­å¢ƒ+ç²¾ç¥å“²å­¦ |
| é»˜è®¤ | 0.15 | 0.20 | 0.25 | 0.20 | 0.20 | v1 åŸå§‹æƒé‡ |

---

## 3. Agent å›¢é˜Ÿè®¾è®¡ï¼ˆv2 æ ¸å¿ƒå‡çº§ï¼‰

### 3.0 Agent çœŸç›¸è¯Šæ–­ï¼ˆ2026-02-10 æ·±åº¦åˆ†æï¼‰â˜… é‡è¦èƒŒæ™¯

> **æ ¸å¿ƒå‘ç°ï¼ˆæ ¡å‡†ç‰ˆï¼‰**ï¼šå½“å‰**ä¸»æ‰§è¡Œé“¾**çš„ 5 ä¸ª"Agent"ä»ä¸æ˜¯ä¸¥æ ¼æ„ä¹‰çš„ Agentã€‚
> ä¸»é“¾æ—  LLM è°ƒç”¨ã€æ—  Tool Callingã€æ— è‡ªä¸»å†³ç­–é—­ç¯ï¼›ä½† v2 å·²æ–°å¢ Agent åŸºç¡€è®¾æ–½ä»£ç ï¼Œå°šæœªæ¥çº¿ã€‚

| "Agent" | ä¸»é“¾å®é™…è¡Œä¸º | LLM è°ƒç”¨ | Tool Calling | è‡ªä¸»å†³ç­– |
|---------|-----------|----------|-------------|---------|
| CriticAgent | `if term_count > 3: score += 0.1` è§„åˆ™å…¬å¼ | **ä¸»é“¾ 0 æ¬¡** | **ä¸»é“¾ 0 æ¬¡** | **æ— ** |
| QueenAgent | `if round > max_rounds: stop` 8 çº§ if-else | **ä¸»é“¾ 0 æ¬¡** | **ä¸»é“¾ 0 æ¬¡** | **æ— ** |
| DraftAgent | `requests.post(together_url)` API å°è£… | **ä¸»é“¾ 0 æ¬¡** | **ä¸»é“¾ 0 æ¬¡** | **æ— ** |
| ScoutService | `jaccard_similarity()` å­—ç¬¦ä¸²åŒ¹é… | **ä¸»é“¾ 0 æ¬¡** | **ä¸»é“¾ 0 æ¬¡** | **æ— ** |
| ArchivistAgent | `json.dump(results)` åºåˆ—åŒ– | **ä¸»é“¾ 0 æ¬¡** | **ä¸»é“¾ 0 æ¬¡** | **æ— ** |

**ä»€ä¹ˆæ˜¯çœŸæ­£çš„ Agent**ï¼ˆå‚è§ `agent-function-calling-architecture-2026-02-10.md` Â§2ï¼‰ï¼š

è‡³å°‘æ»¡è¶³ 4 æ¡æ ‡å‡†ï¼š
1. **æœ‰ç›®æ ‡å’Œå¯æ›´æ–°çŠ¶æ€**ï¼ˆgoal + stateï¼‰â€” L1-L5 LayerState æ­£æ˜¯ Agent çš„çŠ¶æ€ç©ºé—´
2. **èƒ½è‡ªä¸»é€‰æ‹©å·¥å…·**ï¼ˆtool selectionï¼‰â€” ä¸æ˜¯å›ºå®š if-elseï¼Œè€Œæ˜¯ LLM å†³å®šè°ƒä»€ä¹ˆå·¥å…·
3. **èƒ½åŸºäºå·¥å…·ç»“æœæ”¹è®¡åˆ’**ï¼ˆre-planï¼‰â€” æ£€ç´¢åæ”¹ç­–ç•¥ï¼Œä¸æ˜¯å›ºå®šæµç¨‹
4. **æœ‰é¢„ç®—/é£é™©çº¦æŸä¸‹çš„åœæ­¢ç­–ç•¥**ï¼ˆstop policyï¼‰â€” å‘½ä¸­é—¨ç¦æˆ–é¢„ç®—å³åœæ­¢

```
çœŸ Agent = ReAct Pattern + Tool Calling + è‡ªä¸»å†³ç­–
                â”‚                 â”‚            â”‚
                â”‚                 â”‚            â””â”€ LLM è‡ªå·±å†³å®šä½•æ—¶åœæ­¢ï¼ˆstop policyï¼‰
                â”‚                 â””â”€ LLM è‡ªå·±é€‰æ‹©è°ƒä»€ä¹ˆå·¥å…·ã€è°ƒå‡ æ¬¡ï¼ˆtool selectionï¼‰
                â””â”€ LLM â†’ tool_calls â†’ tool_results â†’ LLM â†’ ... â†’ submit_evaluation
```

**"Agent-ness" éªŒè¯æŒ‡æ ‡**ï¼ˆè¯æ˜ä¸æ˜¯"åƒµç¡¬ç³»ç»Ÿ"ï¼Œå‚è§ FC æ¶æ„æ–‡æ¡£ Â§6ï¼‰ï¼š

| æŒ‡æ ‡ | é—¨æ§› | å«ä¹‰ |
|------|------|------|
| Tool-autonomy rate | â‰¥ 70% | è‡³å°‘ 70% è½®æ¬¡ç”± LLM è‡ªä¸»é€‰æ‹©å·¥å…·ï¼Œä¸æ˜¯å›ºå®šæ¨¡æ¿ |
| Re-plan rate | â‰¥ 40% | è‡³å°‘ 40% è½®æ¬¡å‘ç”Ÿ"æ£€ç´¢åæ”¹è®¡åˆ’"ï¼ˆè°ƒå·¥å…·åæ”¹å˜ä¸‹ä¸€æ­¥è¡Œä¸ºï¼‰ |
| Local-rerun efficiency | â‰¤ 35% | å±€éƒ¨é‡ç»˜æˆæœ¬ â‰¤ å…¨é‡é‡è·‘çš„ 35% |
| L3/L5 quality gain | â‰¥ 60% | å¯¹æ¯”è§„åˆ™ one-shotï¼Œç›²è¯„èƒœç‡ â‰¥ 60% |

v2 çš„ Critic å›¢é˜Ÿå°†ä»"è§„åˆ™è„šæœ¬"å‡çº§ä¸º**çœŸæ­£çš„ ReAct Agent**ï¼ˆå½“å‰ä¸ºåŸºç¡€è®¾æ–½å·²è½åœ°ã€ä¸»é“¾å¾…æ¥çº¿ï¼‰ã€‚

### 3.1 æ€»è§ˆï¼š3 å±‚ Agent æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Queen (ç¼–æ’å±‚)                      â”‚
â”‚  èŒè´£ï¼šæ„å›¾ç†è§£ã€æ–‡åŒ–è·¯ç”±ã€é¢„ç®—æ§åˆ¶ã€HITL åè°ƒ        â”‚
â”‚  æ¨¡å‹ï¼šDeepSeek V3.2ï¼ˆ$0.002ï¼Œä¸­è‹±æœ€å¼º+FCï¼‰           â”‚
â”‚  â˜… v2.2: ä¿ç•™è§„åˆ™å†³ç­–æ ‘ + æœªæ¥å¯å‡çº§ä¸º LLM Agent     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 æ‰§è¡Œå±‚ (4 å›¢é˜Ÿ)                       â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Scout   â”‚  â”‚  Draft  â”‚  â”‚ Critic  â”‚  â”‚Archive â”‚ â”‚
â”‚  â”‚ å›¢é˜Ÿ    â”‚  â”‚  å›¢é˜Ÿ   â”‚  â”‚ â˜… ReAct â”‚  â”‚  Agent â”‚ â”‚
â”‚  â”‚(å·¥å…·å±‚) â”‚  â”‚(ç”Ÿæˆå±‚) â”‚  â”‚  Agent  â”‚  â”‚(å½’æ¡£å±‚)â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â–² ReAct Loop            â”‚
â”‚                              â”‚ LLM â†’ tools â†’ LLM    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 å·¥å…·å±‚ (é›¶æˆæœ¬æœ¬åœ° + ä½æˆæœ¬ API)      â”‚
â”‚  FAISS ç´¢å¼• / æœ¯è¯­è¯å…¸ / ç¦åŒºè§„åˆ™ / CLIP / ComfyUI  â”‚
â”‚  â˜… Critic å·¥å…·ï¼šsearch_cultural_refs / lookup_term   â”‚
â”‚  â˜… Critic å·¥å…·ï¼šcheck_sensitivity / read_layer       â”‚
â”‚  â˜… ç»ˆç«¯å·¥å…·ï¼šsubmit_evaluationï¼ˆè°ƒç”¨å³ç»“æŸå¾ªç¯ï¼‰      â”‚
â”‚  â˜… LLM è·¯ç”±ï¼šLiteLLM â†’ DeepSeek/Gemini/Qwen/GPT-4o â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ¯ä¸ª Agent çš„è¯¦ç»†è®¾è®¡

#### Queen Agent â€” ç­–å±•æ€»ç›‘

```
è§’è‰²å®šä½ï¼šç­–å±•å›¢é˜Ÿè´Ÿè´£äººï¼Œç†è§£åˆ›ä½œæ„å›¾ï¼Œåšå…¨å±€å†³ç­–
æ¨¡å‹ï¼šDeepSeek V3.2ï¼ˆ$0.002/æ¬¡ï¼Œä¸­è‹±æœ€å¼º + Function Callingï¼‰
      å¤‡é€‰ï¼šQwen2.5-72B ($0.0007) â†’ GPT-4o-mini ($0.0009)
LLM è°ƒç”¨ï¼š2-3 æ¬¡/ä»»åŠ¡ï¼ˆæ„å›¾è§£æ + æœ€ç»ˆå†³ç­–ï¼‰

â˜… v2.2 ç­–ç•¥ï¼š
  - å½“å‰é˜¶æ®µä¿ç•™è§„åˆ™å†³ç­–æ ‘ï¼ˆ8 çº§ if-elseï¼Œé›¶æˆæœ¬ï¼‰ï¼Œå·²éªŒè¯æœ‰æ•ˆ
  - Intent è§£æå‡çº§ä¸º LLM Agentï¼ˆå°†ç”¨æˆ·è‡ªç„¶è¯­è¨€è§£æä¸º IntentCardV2ï¼‰
  - å¤šè½®å†³ç­–æ–°å¢ rerun_local/rerun_global åˆ†æµ + expected_gain_per_cost
  - æœªæ¥å¯å°†æ•´ä¸ª Queen å†³ç­–æ ‘å‡çº§ä¸º LLM Agentï¼ˆè¯»å– LayerState è‡ªä¸»å†³ç­–ï¼‰

èŒè´£ï¼š
  1. Intent è§£æï¼ˆLLMï¼‰ï¼šå°†ç”¨æˆ·è¾“å…¥è§£æä¸ºç»“æ„åŒ– IntentCardV2
     è¾“å…¥: "è‘£æºé£æ ¼å±±æ°´ï¼Œä½“ç°è¿œå±±å«é»›"
     è¾“å‡º: IntentCardV2 {
       subject: "mountain landscape",
       tradition: "chinese_xieyi",
       style_ref: "Dong Yuan hemp-fiber strokes",
       l5_anchor: "è¿œå±±å«é»› â€” æœ¦èƒ§ä¸­è§æ·±è¿œçš„é“å®¶æ„å¢ƒ",
       difficulty: "hard",
       target_profile: {L1:0.7, L2:0.7, L3:0.8, L4:0.6, L5:0.8},
       must_pass_layers: ["cultural_context", "philosophical_aesthetic"],
       budget_plan: {max_rounds: 3, max_cost: 0.05}
     }
  2. æ–‡åŒ–è·¯ç”±ï¼šæ ¹æ® tradition é€‰æ‹©å¯¹åº”çš„ç®¡é“å˜ä½“
  3. é¢„ç®—æ§åˆ¶ï¼š8 çº§å†³ç­–å±‚æ¬¡ï¼ˆä¿ç•™ v1ï¼‰+ æŒ‰å±‚åˆ†è´¦ï¼ˆv2 æ–°å¢ï¼‰
  4. HITL åè°ƒï¼šæš‚åœ/æ¢å¤/è§£é‡Šå†³ç­–ç†ç”±
  5. å¤šè½®ç­–ç•¥ï¼ˆv2 å‡çº§ï¼‰ï¼š
     - è¯»å– LayerStateï¼ˆscore/confidence/evidence_coverageï¼‰
     - å¼±å±‚æ¨¡å¼è¯†åˆ«ï¼ˆsurface_weak/culture_weak/depth_weak/cross_layer_gapï¼‰
     - å†³å®š rerun_localï¼ˆå±€éƒ¨ä¿®æ”¹ï¼‰vs rerun_globalï¼ˆå…¨é‡é‡è·‘ï¼‰
     - expected_gain_per_cost æˆæœ¬æ•ˆç›Šæ£€æŸ¥
```

#### Scout å›¢é˜Ÿ â€” æŒ‰ L å±‚çº§åˆ†å·¥çš„è¯æ®æ”¶é›†

```
Scout-L1ï¼ˆè§†è§‰å‚è€ƒï¼‰
  å·¥å…·ï¼šCLIP åµŒå…¥ + FAISS ç´¢å¼•
  è¾“å…¥ï¼šsubject + style_ref
  è¾“å‡ºï¼šTop-5 è§†è§‰ç›¸ä¼¼çš„å‚è€ƒä½œå“ï¼ˆæ„å›¾/è‰²å½©/å½¢å¼ï¼‰
  æ¨¡å‹ï¼šCLIP ViT-B/32ï¼ˆæœ¬åœ°ï¼Œ<1GB VRAMï¼‰
  æˆæœ¬ï¼š$0

Scout-L3ï¼ˆæ–‡åŒ–è¯æ®ï¼‰
  å·¥å…·ï¼šæœ¯è¯­è¯å…¸ + Wikidata SPARQL + FAISS æ–‡æœ¬æ£€ç´¢
  è¾“å…¥ï¼štradition + subject + l5_anchor
  è¾“å‡ºï¼šæ–‡åŒ–ç¬¦å·æ¸…å•ã€å…¸æ•…å…³è”ã€ä¼ ç»Ÿè§„èŒƒ
  æ¨¡å‹ï¼šæ— ï¼ˆè§„åˆ™ + API æŸ¥è¯¢ï¼‰
  æˆæœ¬ï¼š$0

Scout-L5ï¼ˆå“²å­¦å®šé”šï¼‰
  å·¥å…·ï¼šFAISS æ–‡æœ¬æ£€ç´¢ï¼ˆç¾å­¦æ–‡çŒ®åº“ï¼‰
  è¾“å…¥ï¼šl5_anchor + tradition
  è¾“å‡ºï¼šå“²å­¦æºæµã€ç¾å­¦ç†å¿µã€æ„å¢ƒå‚è€ƒ
  æ¨¡å‹ï¼šDeepSeek V3ï¼ˆä½æˆæœ¬ LLM åšæ–‡çŒ®æ‘˜è¦ï¼‰
  æˆæœ¬ï¼š~$0.002/æ¬¡

Scout-Tabooï¼ˆç¦å¿Œæ£€æŸ¥ï¼‰
  å·¥å…·ï¼šç¦åŒºè§„åˆ™å¼•æ“ï¼ˆä¿ç•™ v1ï¼‰
  è¾“å…¥ï¼šsubject + tradition + æ‰€æœ‰ Scout è¯æ®
  è¾“å‡ºï¼šç¦å¿Œè¿è§„åˆ—è¡¨ + ä¸¥é‡åº¦
  æ¨¡å‹ï¼šæ— 
  æˆæœ¬ï¼š$0
```

#### Draft å›¢é˜Ÿ â€” æŒ‰åˆ›ä½œé˜¶æ®µåˆ†å·¥çš„å›¾åƒç”Ÿæˆ

```
Draft-Composeï¼ˆæ„å›¾ï¼‰
  æ¨¡å‹ï¼šSD 1.5ï¼ˆæœ¬åœ° ComfyUIï¼Œ4GB VRAMï¼‰
  è¾“å…¥ï¼šScout-L1 è§†è§‰å‚è€ƒ + Queen Intent Card
  è¾“å‡ºï¼š512Ã—512 ä½åˆ†è¾¨ç‡æ„å›¾è‰å›¾ Ã— 4
  æ§åˆ¶ï¼šåŸºç¡€ txt2img + æ„å›¾å¼•å¯¼
  æˆæœ¬ï¼š$0ï¼ˆæœ¬åœ°æ¨ç†ï¼‰

Draft-Styleï¼ˆé£æ ¼æ¸²æŸ“ï¼‰
  æ¨¡å‹ï¼šIP-Adapterï¼ˆæœ¬åœ° ComfyUIï¼Œ+2GB VRAMï¼‰
  è¾“å…¥ï¼šæ„å›¾è‰å›¾ + Scout-L1 é£æ ¼å‚è€ƒå›¾
  è¾“å‡ºï¼šå¸¦é£æ ¼çš„ä¸­é—´ç¨¿
  æ§åˆ¶ï¼šIP-Adapter weight 0.5-0.8ï¼Œä¿æ„å›¾æ”¹é£æ ¼
  æˆæœ¬ï¼š$0ï¼ˆæœ¬åœ°æ¨ç†ï¼‰

Draft-Refineï¼ˆå±€éƒ¨é‡ç»˜ï¼‰â˜… v2 æ–°å¢
  æ¨¡å‹ï¼šControlNet canny/depthï¼ˆæœ¬åœ° ComfyUIï¼Œ+2GB VRAMï¼‰
  è¾“å…¥ï¼šä¸Šä¸€è½®æœ€ä½³å€™é€‰ + Critic åé¦ˆï¼ˆå“ªäº›åŒºåŸŸéœ€ä¿®æ”¹ï¼‰
  è¾“å‡ºï¼šå±€éƒ¨ä¿®æ”¹åçš„å›¾åƒï¼ˆä¿ç•™å¥½çš„éƒ¨åˆ†ï¼‰
  æ§åˆ¶ï¼šinpaint mask ç”± Critic æŒ‡å®šåŒºåŸŸ
  æˆæœ¬ï¼š$0ï¼ˆæœ¬åœ°æ¨ç†ï¼‰

Draft-HiResï¼ˆé«˜è´¨é‡æ¸²æŸ“ï¼‰
  æ¨¡å‹ï¼šFLUX.1-schnellï¼ˆTogether.ai APIï¼‰æˆ– SDXLï¼ˆæœ¬åœ°å¤‡é€‰ï¼‰
  è¾“å…¥ï¼šé€šè¿‡ Critic çš„ä¸­é—´ç¨¿
  è¾“å‡ºï¼šæœ€ç»ˆé«˜è´¨é‡æ¸²æŸ“
  æˆæœ¬ï¼š$0.003/å¼ ï¼ˆTogether.aiï¼‰
  ä½•æ—¶è§¦å‘ï¼šä»…åœ¨ Critic è¯„åˆ† â‰¥ 0.6 åçš„æœ€ç»ˆé˜¶æ®µ
```

#### Critic å›¢é˜Ÿ â€” ReAct Agent + æ··åˆæ¨¡å¼è¯„å®¡ â˜…â˜…â˜… v2 æ ¸å¿ƒå‡çº§

> **v2.2 æ¶æ„é©å‘½**ï¼ˆ2026-02-10 Agent çœŸç›¸åˆ†æåï¼‰ï¼š
> - **æ ¸å¿ƒå˜åŒ–**ï¼šCritic ä»"è§„åˆ™è„šæœ¬"å‡çº§ä¸º **ReAct Agent**ï¼ˆLLM è‡ªä¸»é€‰å·¥å…·ã€è‡ªä¸»æ¨ç†ã€è‡ªä¸»å†³ç­–ï¼‰
> - **æ¨¡å‹åˆ‡æ¢**ï¼šClaude Sonnet ($0.02) â†’ **DeepSeek V3.2** ($0.002) + **Gemini Flash-Lite** ($0.001)
> - **ç»Ÿä¸€è·¯ç”±**ï¼šé€šè¿‡ **LiteLLM** ä¸€è¡Œä»£ç åˆ‡æ¢æ¨¡å‹ï¼ŒFallback Chain ä¿è¯å¯ç”¨æ€§
> - **å·¥å…·è°ƒç”¨**ï¼šLLM é€šè¿‡ Function Calling è‡ªä¸»è°ƒç”¨ 5 ä¸ªå·¥å…·ï¼ˆsearch_cultural_references / lookup_terminology / check_cultural_sensitivity / read_layer_analysis / submit_evaluationï¼‰
> - **è§„åˆ™å±‚ä¿ç•™**ï¼štaboo æ£€æŸ¥ã€åŸºç¡€è§„èŒƒéªŒè¯ä»ä¸ºç¡¬é—¨ç¦ï¼ˆç¡®å®šæ€§ã€é›¶æˆæœ¬ã€ä¸å¯ç»•è¿‡ï¼‰
> - **æ¸è¿›æ·±åŒ–**ï¼šL1â†’L2â†’L3â†’L4â†’L5 ä¸²è¡Œï¼Œæ¯å±‚è¯»å–å‰å±‚å‘ç° + æ¡ä»¶åå“ºè½®

```
â”Œâ”€ è§„åˆ™å±‚ï¼ˆä¿ç•™ v1ï¼Œ$0ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Critic-Rule-L1/L2: è§„åˆ™åŒ–è§†è§‰/æŠ€æ³•æ£€æŸ¥ï¼ˆåŸºçº¿å®ˆé—¨ï¼‰    â”‚
â”‚  Critic-Taboo: ç¦å¿Œç¡¬é—¨ç¦ï¼ˆä¸å¯ç»•è¿‡ï¼‰                  â”‚
â”‚  è§¦å‘ï¼šæ¯æ¬¡å¿…è·‘                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ è§„åˆ™é€šè¿‡ + éœ€æ·±åº¦è¯„å®¡
        â–¼
â”Œâ”€ ReAct Agent å±‚ï¼ˆv2.2 æ ¸å¿ƒï¼ŒæŒ‰éœ€è§¦å‘ï¼‰â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚        AgentRuntime (ReAct Loop)      â”‚            â”‚
â”‚  â”‚                                       â”‚            â”‚
â”‚  â”‚  LLM â”€â”€â†’ tool_calls â”€â”€â†’ tool_results â”‚            â”‚
â”‚  â”‚   â–²                         â”‚         â”‚            â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚            â”‚
â”‚  â”‚         (é‡å¤ 1-N è½®)                  â”‚            â”‚
â”‚  â”‚              â”‚                         â”‚            â”‚
â”‚  â”‚              â–¼                         â”‚            â”‚
â”‚  â”‚      submit_evaluation (ç»ˆæ­¢)          â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                       â”‚
â”‚  æ¨¡å‹è·¯ç”±ï¼ˆModelRouter + Fallback Chainï¼‰ï¼š            â”‚
â”‚    L1/L2 â†’ Gemini 2.5 Flash-Lite VLM ($0.001)        â”‚
â”‚    L3/L4/L5 â†’ DeepSeek V3.2 FC ($0.002)              â”‚
â”‚    Fallback: DeepSeek â†’ Qwen2.5-72B â†’ GPT-4o-mini    â”‚
â”‚                                                       â”‚
â”‚  è§¦å‘ç­–ç•¥ï¼š                                           â”‚
â”‚    L3/L5 â˜… å¿…è·‘ï¼ˆæƒé‡æœ€é«˜ + æ–‡åŒ–æ ¸å¿ƒï¼‰               â”‚
â”‚    L1/L2 ä»…åœ¨è§„åˆ™è¯„åˆ†ç½®ä¿¡åº¦ä½æ—¶ï¼ˆé€‰æ‹©æ€§å‡çº§ï¼‰         â”‚
â”‚    L4 ä»…åœ¨ L3 < 0.6 æˆ– western_academic æ—¶            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

##### ReAct Agent æ‰§è¡Œæµç¨‹ï¼ˆæ¯å±‚ç‹¬ç«‹å¾ªç¯ï¼‰

```
AgentContext â†’ AgentRuntime.evaluate() â†’ AgentResult

æ¯å±‚å¾ªç¯ï¼ˆmax_steps=5ï¼‰ï¼š
  Step 1: LLM è¯»å– system_prompt + user_message(å«è¯æ®æ‘˜è¦)
          â†’ å†³å®šè°ƒç”¨ search_cultural_references("å±±æ°´æŠ€æ³•", "chinese_xieyi")
  Step 2: å·¥å…·æ‰§è¡Œ â†’ è¿”å› FAISS Top-5 åŒ¹é…ç»“æœ
          â†’ LLM åˆ†æåŒ¹é…ç»“æœ
          â†’ å†³å®šè°ƒç”¨ lookup_terminology("çš´æ³•", "chinese_xieyi")
  Step 3: å·¥å…·æ‰§è¡Œ â†’ è¿”å›æœ¯è¯­å®šä¹‰ + ç½®ä¿¡åº¦
          â†’ LLM ç»¼åˆæ¨ç†
          â†’ å†³å®šè°ƒç”¨ submit_evaluation(score=0.72, confidence=0.85, ...)
  â˜… å¾ªç¯ç»“æŸ â†’ AgentResult å†™å…¥ LayerState
```

##### Critic å·¥å…·æ¸…å•ï¼ˆ5 ä¸ªï¼Œå·²å®ç°ï¼‰

| å·¥å…· | åŠŸèƒ½ | æ‰§è¡Œè€… |
|------|------|--------|
| `search_cultural_references` | FAISS å‘é‡æ£€ç´¢æ–‡åŒ–å‚è€ƒæ–‡çŒ® | ScoutService |
| `lookup_terminology` | æ–‡åŒ–æœ¯è¯­è¯å…¸æŸ¥è¯¢ | ScoutService |
| `check_cultural_sensitivity` | ç¦å¿Œ/æ•æ„Ÿæ€§æ£€æŸ¥ | ScoutService |
| `read_layer_analysis` | è¯»å–å‰å±‚è¯„å®¡ç»“æœï¼ˆè·¨å±‚æ¨ç†ï¼‰ | LayerResults |
| `submit_evaluation` â˜… | æäº¤æœ€ç»ˆè¯„åˆ†ï¼ˆç»ˆæ­¢å¾ªç¯ï¼‰ | ç›´æ¥è¿”å› |

> **Phase D æ‰©å±•å·¥å…·**ï¼ˆå‚è§ FC æ¶æ„æ–‡æ¡£ Â§3.2ï¼ŒPhase C å®Œæˆåæ·»åŠ ï¼‰ï¼š

| å·¥å…· | åŠŸèƒ½ | å®ç°é˜¶æ®µ | æ‰§è¡Œè€… |
|------|------|---------|--------|
| `propose_region_masks` | æ ¹æ®å¼±å±‚åˆ†æç”Ÿæˆå±€éƒ¨é‡ç»˜ mask | Phase D | VLM + Critic-L1 |
| `run_local_inpaint` | è°ƒç”¨ ComfyUI inpaint æ‰§è¡Œå±€éƒ¨é‡ç»˜ | Phase D | ComfyUIProvider |
| `estimate_round_cost` | é¢„ä¼°ä¸€è½®é‡è·‘/å±€éƒ¨é‡ç»˜çš„æˆæœ¬ | Phase D | ModelRouter |

> å½“å‰ Phase B' å®ç°äº† 5 ä¸ªæ ¸å¿ƒ Critic å·¥å…·ã€‚Phase D å°†æ‰©å±•è‡³ 8 ä¸ªå·¥å…·ï¼Œ
> è¦†ç›– FC æ¶æ„æ–‡æ¡£æ¨èçš„å®Œæ•´å·¥å…·é›†ï¼ˆ`retrieve_evidence` å·²æ‹†åˆ†ä¸º `search_cultural_references` + `lookup_terminology`ï¼‰ã€‚

##### æ¯å±‚ Agent è¯¦ç»†è®¾è®¡

```
Critic-L1ï¼ˆè§†è§‰åˆ†æ Agentï¼‰â€” é€‰æ‹©æ€§å‡çº§
  æ¨¡å‹ï¼šGemini 2.5 Flash-Liteï¼ˆ$0.001ï¼ŒVLM + FCï¼‰
  è¾“å…¥ï¼šå€™é€‰å›¾ URL + Scout-L1 è§†è§‰å‚è€ƒ
  System Promptï¼šåŸºäº Feldman Description å±‚
    "You are an expert art critic evaluating L1 (Visual Perception).
     Analyze composition, color, form, and spatial arrangement.
     Use available tools to gather evidence. When ready, call submit_evaluation."
  ReAct è¡Œä¸ºï¼šLLM è‡ªä¸»å†³å®šæ˜¯å¦è°ƒç”¨å·¥å…·ï¼ˆ0-3 è½®ï¼‰
  è§¦å‘æ¡ä»¶ï¼šè§„åˆ™ L1 è¯„åˆ† < 0.7 æˆ– Scout å‚è€ƒæ•° < 3

Critic-L2ï¼ˆæŠ€æ³•åˆ†æ Agentï¼‰â€” é€‰æ‹©æ€§å‡çº§
  æ¨¡å‹ï¼šGemini 2.5 Flash-Liteï¼ˆ$0.001ï¼ŒVLM + FCï¼‰
  è¾“å…¥ï¼šå€™é€‰å›¾ URL + Scout-L3 æœ¯è¯­æ¸…å•
  System Promptï¼šåŸºäº Feldman Analysis å±‚
  ReAct è¡Œä¸ºï¼šå¯èƒ½è°ƒç”¨ lookup_terminology éªŒè¯æŠ€æ³•æœ¯è¯­
  è§¦å‘æ¡ä»¶ï¼šè§„åˆ™ L2 è¯„åˆ† < 0.7 æˆ–æœ¯è¯­å‘½ä¸­ç‡ < 50%

Critic-L3ï¼ˆæ–‡åŒ–è¯­å¢ƒ Agentï¼‰â˜… å¿…è·‘ï¼Œæƒé‡æœ€é«˜
  æ¨¡å‹ï¼šDeepSeek V3.2ï¼ˆ$0.002ï¼Œä¸­æ–‡æ–‡åŒ–çŸ¥è¯†æœ€å¼º + FCï¼‰
  è¾“å…¥ï¼šå…¨éƒ¨ Scout è¯æ®ï¼ˆFAISS å‘é‡æ£€ç´¢ç»“æœï¼‰
  System Promptï¼šåŸºäº Panofsky Iconographic å±‚
    "You are an expert art critic evaluating L3 (Cultural Context).
     Assess historical accuracy, cultural grounding, and tradition adherence.
     Use search_cultural_references and lookup_terminology to find evidence.
     Read prior layer analyses with read_layer_analysis.
     When ready, call submit_evaluation with score, confidence, rationale, evidence_refs."
  ReAct è¡Œä¸ºï¼ˆå…¸å‹ 2-3 è½®ï¼‰ï¼š
    â†’ search_cultural_references("ä¼ ç»Ÿ+ä¸»é¢˜")
    â†’ lookup_terminology("å…³é”®æœ¯è¯­")
    â†’ read_layer_analysis("L1")ï¼ˆå¦‚éœ€å‚è€ƒå‰å±‚ï¼‰
    â†’ submit_evaluation(score, confidence, rationale, evidence_refs)
  å‰ç½®ï¼šScout FAISS æ£€ç´¢å®Œæˆï¼ˆä¸º LLM æä¾›é”šå®šï¼Œé¿å…æ¼‚ç§»ï¼‰

Critic-L4ï¼ˆæ‰¹è¯„è§£è¯» Agentï¼‰â€” é€‰æ‹©æ€§å‡çº§
  æ¨¡å‹ï¼šDeepSeek V3.2ï¼ˆ$0.002ï¼ŒFC + æ¨ç†èƒ½åŠ›å¼ºï¼‰
  è¾“å…¥ï¼šL1-L3 è¯„åˆ†ç»“æœ
  System Promptï¼šåŸºäº Panofsky Iconological + Feldman Interpretation
  ReAct è¡Œä¸ºï¼šread_layer_analysis("L1"/"L2"/"L3") â†’ ç»¼åˆæ¨ç† â†’ submit
  è§¦å‘æ¡ä»¶ï¼šL3 è¯„åˆ† < 0.6 æˆ– tradition ä¸º "western_academic"

Critic-L5ï¼ˆå“²å­¦ç¾å­¦ Agentï¼‰â˜… å¿…è·‘
  æ¨¡å‹ï¼šDeepSeek V3.2ï¼ˆ$0.002ï¼ŒFC + æ·±åº¦æ¨ç†ï¼‰
  è¾“å…¥ï¼šScout-L5 å“²å­¦é”šå®š + L1-L4 è¯„åˆ†
  System Promptï¼šåŸºäºæœ€é«˜å±‚åˆ¤æ–­
    "You are an expert art critic evaluating L5 (Philosophical & Aesthetic).
     This is the deepest evaluation layer â€” synthesize findings from L1-L4.
     Read prior layer analyses with read_layer_analysis.
     When ready, call submit_evaluation."
  ReAct è¡Œä¸ºï¼ˆå…¸å‹ 2-4 è½®ï¼‰ï¼š
    â†’ read_layer_analysis("L3")
    â†’ read_layer_analysis("L4")
    â†’ search_cultural_references("å“²å­¦é”šç‚¹+ä¼ ç»Ÿ")
    â†’ submit_evaluation(score, confidence, rationale, evidence_refs)
```

##### æ¨¡å‹è·¯ç”±ä¸ Fallback Chainï¼ˆå·²å®ç°ï¼‰

```python
# ModelRouter è·¯ç”±ç­–ç•¥ï¼ˆapp/prototype/agents/model_router.pyï¼‰
DEFAULT_LAYER_MODELS = {
    "visual_perception":      "gemini_flash_lite",  # L1: éœ€ VLM ($0.001)
    "technical_analysis":     "gemini_flash_lite",  # L2: éœ€ VLM ($0.001)
    "cultural_context":       "deepseek_v3",        # L3: éœ€ FC + ä¸­æ–‡æœ€å¼º ($0.002)
    "critical_interpretation": "deepseek_v3",       # L4: éœ€ FC + æ¨ç† ($0.002)
    "philosophical_aesthetic": "deepseek_v3",       # L5: éœ€ FC + æ·±åº¦æ¨ç† ($0.002)
}

# Fallback Chainï¼ˆä¸»æ¨¡å‹ä¸å¯ç”¨/è¶…é¢„ç®—æ—¶è‡ªåŠ¨é™çº§ï¼‰
FALLBACK_CHAINS = {
    "deepseek_v3":      ["qwen_72b", "gpt4o_mini"],       # DS â†’ Qwen â†’ GPT
    "gemini_flash_lite": ["gpt4o_mini"],                    # Gemini â†’ GPT
    "qwen_72b":          ["gpt4o_mini"],                    # Qwen â†’ GPT
    "gpt4o_mini":        [],                                # æœ€åé˜²çº¿
}
# æœ€ç»ˆ Fallback: å¦‚æœæ‰€æœ‰ LLM ä¸å¯ç”¨ â†’ å›é€€è§„åˆ™å¼•æ“ï¼ˆé›¶æˆæœ¬ï¼‰
```

##### æ¨¡å‹é€‰æ‹©å†³ç­–ç†ç”±ï¼ˆ2026-02-10 æ·±åº¦åˆ†æï¼‰

| å¯¹æ¯”ç»´åº¦ | Claude Sonnet (æ—§æ–¹æ¡ˆ) | DeepSeek V3.2 (æ–°æ–¹æ¡ˆ) | å·®å¼‚å€æ•° |
|---------|----------------------|----------------------|---------|
| å•æ¬¡è°ƒç”¨æˆæœ¬ | ~$0.02 | ~$0.002 | **10x ä¾¿å®œ** |
| L3 æ–‡åŒ–è¯„å®¡ï¼ˆä¸­æ–‡çŸ¥è¯†ï¼‰ | å¥½ | **æ›´å¥½**ï¼ˆä¸­æ–‡è®­ç»ƒæ•°æ®æœ€å¤šï¼‰ | è´¨é‡â†‘ |
| Function Calling | âœ… | âœ… | æŒå¹³ |
| VLMï¼ˆçœ‹å›¾èƒ½åŠ›ï¼‰ | âŒ éœ€åˆ‡æ¢ GPT-4o-vision | âŒ éœ€åˆ‡æ¢ Gemini Flash-Lite | â€” |
| Gemini Flash-Lite VLM | â€” | $0.001ï¼ˆæœ€ä¾¿å®œ VLM+FCï¼‰ | â€” |
| æ—¥é¢„ç®— $5 è¦†ç›–æ¬¡æ•° | ~25-58 æ¬¡ | **500-1250 æ¬¡** | **20x+** |

#### æˆæœ¬ä¼˜åŒ–ï¼šReAct Agent + æ¨¡å‹åˆ‡æ¢çš„æ•ˆæœ

```
æ—§æ–¹æ¡ˆï¼ˆClaude Sonnet + GPT-4o-visionï¼‰ï¼š
  å…¨é‡ LLMï¼š$0.01Ã—2 + $0.02Ã—3 = $0.08/æ ·ä¾‹
  é€‰æ‹©æ€§å‡çº§ï¼š$0.04-$0.06/æ ·ä¾‹

â˜… æ–°æ–¹æ¡ˆï¼ˆDeepSeek V3.2 + Gemini Flash-Liteï¼‰ï¼š
  å…¨é‡ LLMï¼š$0.001Ã—2 + $0.002Ã—3 = $0.008/æ ·ä¾‹ â† èŠ‚çœ 91%
  é€‰æ‹©æ€§å‡çº§ï¼š$0.004/æ ·ä¾‹ â† èŠ‚çœ 95%
  é™çº§æ¨¡å¼ï¼šä»… L3 å¿…è·‘ = $0.002/æ ·ä¾‹

æ¨¡å‹åˆ‡æ¢æ•ˆæœæ€»ç»“ï¼š
  æˆæœ¬ï¼š$0.08 â†’ $0.008ï¼ˆ-91%ï¼‰
  æ—¥è¦†ç›–ï¼š25-58 æ¬¡ â†’ 500-1250 æ¬¡ï¼ˆ+20xï¼‰
  è´¨é‡ï¼šL3 æ–‡åŒ–è¯„å®¡å›  DeepSeek ä¸­æ–‡èƒ½åŠ›æ›´å¼ºï¼Œé¢„æœŸæŒå¹³æˆ–æ›´å¥½
```

#### Archivist Agent â€” è¯æ®é“¾å½’æ¡£

```
èŒè´£ï¼šæŒ‰ L1-L5 ç»„ç»‡å®Œæ•´è¯æ®é“¾
è¾“å‡ºï¼š
  evidence_chain.json â€” æ¯å±‚çš„è¯æ® + è¯„åˆ† + ç†ç”±
  critique_card.md    â€” äººç±»å¯è¯»çš„ 5 å±‚è¯„å®¡æŠ¥å‘Š
  params_snapshot.json â€” å®Œæ•´å¯å¤ç°å‚æ•°
  provenance.json     â€” æ¯å±‚çš„æ¨¡å‹/å·¥å…·/è¾“å…¥æº¯æº
æ¨¡å‹ï¼šDeepSeek V3ï¼ˆä½æˆæœ¬æ–‡æœ¬æ•´ç†ï¼‰
æˆæœ¬ï¼š~$0.001/æ¬¡
```

---

## 4. å±€éƒ¨é‡ç»˜æœºåˆ¶ï¼ˆv2 æ–°å¢ï¼‰

### 4.1 åŸç†ï¼šä¸æ˜¯å…¨é‡é‡è·‘ï¼Œè€Œæ˜¯åœ¨åŸå›¾ä¸Šä¿®æ”¹

```
v1 çš„ "Rerun"ï¼ˆå…¨é‡é‡è·‘ï¼‰ï¼š
  Round 1: img_A (seed 42) â†’ Critic: L1=0.9, L3=0.3
  Round 2: img_B (seed 142) â†’ å…¨æ–°å›¾ï¼Œå’Œ img_A æ— å…³

v2 çš„ "Refine"ï¼ˆå±€éƒ¨é‡ç»˜ï¼‰ï¼š
  Round 1: img_A â†’ Critic: L1=0.9 âœ“, L3=0.3 âœ—
  Round 2: img_A' = inpaint(img_A, mask=L3åŒºåŸŸ, prompt="å¢åŠ æ–‡åŒ–ç¬¦å·")
           â†’ ä¿ç•™ L1 å¥½çš„æ„å›¾ï¼Œåªä¿®æ”¹ L3 å¼±çš„æ–‡åŒ–å…ƒç´ 
```

### 4.2 æŠ€æœ¯å®ç°ï¼šComfyUI å·¥ä½œæµ

```
å±€éƒ¨é‡ç»˜æµç¨‹ï¼š
  1. Critic è¾“å‡º â†’ è¯†åˆ«å¼±ç»´åº¦ï¼ˆå¦‚ L3 < 0.5ï¼‰
  2. Critic-L1 çš„ VLM åˆ†æ â†’ ç”Ÿæˆ attention map / mask
     "æŒ‡å‡ºå›¾ä¸­å“ªäº›åŒºåŸŸç¼ºä¹æ–‡åŒ–ç¬¦å·"
  3. Draft-Refine æ¥æ”¶ï¼š
     - åŸå§‹å›¾åƒï¼ˆimg_Aï¼‰
     - ä¿®æ”¹æ©ç ï¼ˆmaskï¼‰
     - ä¿®æ”¹æç¤ºï¼ˆ"åœ¨æ­¤åŒºåŸŸå¢åŠ  {cultural_symbols}"ï¼‰
  4. ComfyUI inpaint å·¥ä½œæµï¼š
     - ControlNet depthï¼ˆä¿æŒä¸‰ç»´ç»“æ„ï¼‰
     - mask åŒºåŸŸé‡ç»˜ï¼ˆä»…ä¿®æ”¹æŒ‡å®šéƒ¨åˆ†ï¼‰
     - å…¶ä½™åŒºåŸŸå®Œå…¨ä¿ç•™

VRAM éœ€æ±‚ï¼šSD 1.5 + ControlNet + inpaint â‰ˆ 6-7GBï¼ˆRTX 2070 å¯è·‘ï¼‰
```

### 4.3 rerun_local vs rerun_global åˆ†æµ â˜… v2.2 å‡çº§

Queen å†³ç­–ä¸å†åªæœ‰ "rerun"ï¼Œè€Œæ˜¯åˆ†ä¸ºä¸¤æ¡æ‰§è¡Œé“¾ï¼š

| Queen å†³ç­– | è§¦å‘æ¡ä»¶ | æ‰§è¡Œé“¾ |
|-----------|---------|--------|
| `rerun_local` | L1/L2 å¥½ + L3 æˆ– L5 å¼± | LocalRerunRequest â†’ mask inpaint â†’ ä¿ç•™å¥½çš„éƒ¨åˆ† |
| `rerun_global` | L1 å·®ï¼ˆç»“æ„å±‚å¤±çœŸï¼‰æˆ–å…¨éƒ¨ < 0.4 | å…¨é‡é‡è·‘ Draft-Compose |
| æ–‡åŒ–è¦†ç›– | å†™æ„ç”»ä»»ä½• rerun_local | â†’ è¦†ç›–ä¸º rerun_globalï¼ˆä¸€æ°”å‘µæˆï¼‰ |

### 4.4 ç»´åº¦é”å®šä¸é‡ç»˜çš„æ˜ å°„

| Critic åˆ¤æ–­ | é”å®š | Queen å†³ç­– | é‡ç»˜ç­–ç•¥ |
|------------|------|-----------|---------|
| L1 å¥½ + L3 å·® | é”å®šæ„å›¾ | `rerun_local` | ControlNet depth ä¿æ„å›¾ï¼Œinpaint å¢æ–‡åŒ–ç¬¦å· |
| L2 å¥½ + L5 å·® | é”å®šæŠ€æ³• | `rerun_local` | IP-Adapter ä¿é£æ ¼ï¼Œä¿®æ”¹æ„å¢ƒè¡¨è¾¾ |
| L1 å·® + å…¶ä½™å¥½ | ä¸é”å®š | `rerun_global` | å…¨é‡é‡æ–°æ„å›¾ï¼ˆæ­¤æ—¶å±€éƒ¨é‡ç»˜ä¸é€‚ç”¨ï¼‰ |
| å…¨éƒ¨ < 0.4 | æ—  | `rerun_global` | å…¨é‡é‡è·‘ï¼ˆå›é€€åˆ° Draft-Composeï¼‰ |

### 4.5 å±€éƒ¨é‡ç»˜éªŒæ”¶ç¡¬æŒ‡æ ‡

| æŒ‡æ ‡ | é˜ˆå€¼ | å«ä¹‰ |
|------|------|------|
| é”å®šå±‚ä¿çœŸ | â‰¥ 95% | preserve_layers åˆ†æ•°å˜åŒ– â‰¤ 5% |
| è·¨ç»´æ¼‚ç§» | â‰¤ 10% | éç›®æ ‡å±‚åˆ†æ•°åç§»ä¸Šé™ |
| å±€éƒ¨é‡ç»˜æˆæœ¬æ¯” | â‰¤ 35% | å±€éƒ¨æˆæœ¬ / å…¨é‡é‡è·‘æˆæœ¬ |

---

## 5. æ–‡åŒ–è·¯ç”±ç®¡é“ï¼ˆv2 æ–°å¢ï¼‰

### 5.1 ä¸‰æ¡é¦–æ‰¹ç®¡é“

#### é»˜è®¤ç®¡é“ï¼ˆå®Œæ•´ 8 é˜¶æ®µï¼‰
```
Intent â†’ Scout(L1+L3+L5) â†’ Draft-Compose â†’ Critic(L1-L5)
  â†’ [HITL] â†’ Draft-Refine â†’ Critic(äºŒå®¡) â†’ Draft-HiRes â†’ Archive
```

#### ä¸­å›½å†™æ„ç®¡é“ï¼ˆæ„åœ¨ç¬”å…ˆ + åŸå­æ‰§è¡Œï¼‰
```
Intent â†’ Scout(L3+L5ï¼Œé‡å“²å­¦å®šé”š)
  â†’ Queen ç¡®è®¤ L5 é”šç‚¹
  â†’ Draft-Compose + Draft-Styleï¼ˆåŸå­æ‰§è¡Œï¼Œä¸€æ°”å‘µæˆï¼‰
  â†’ Critic(L3:0.25, L5:0.30 é«˜æƒé‡)
  â†’ [HITL] â†’ è‹¥ä¸é€šè¿‡ï¼šå…¨é‡é‡æ¥ï¼ˆå†™æ„ä¸å±€éƒ¨ä¿®æ”¹ï¼‰
  â†’ Archive
```
ç‰¹ç‚¹ï¼šå†™æ„ç”» "ä¸€æ°”å‘µæˆ"ï¼Œä¸åšå±€éƒ¨ä¿®æ”¹ã€‚L5 å“²å­¦æƒé‡æœ€é«˜ã€‚

#### è¥¿æ–¹å­¦é™¢æ´¾ç®¡é“ï¼ˆæ˜æš—â†’è‰²å½©â†’æ¸²æŸ“ï¼Œä¸‰æ­¥é€’è¿›ï¼‰
```
Intent â†’ Scout(L1+L2ï¼Œé‡è§†è§‰+æŠ€æ³•å‚è€ƒ)
  â†’ Draft-Composeï¼ˆæ„å›¾ + æ˜æš—ç ”ç©¶ï¼Œç°åº¦å›¾ï¼‰
  â†’ Critic-L1+L2ï¼ˆä»…è¯„è§†è§‰+æŠ€æ³•ï¼‰
  â†’ [HITL] â†’ é€šè¿‡åç»§ç»­
  â†’ Draft-Styleï¼ˆè‰²å½©ç ”ç©¶ï¼ŒåŸºäºç°åº¦å›¾ä¸Šè‰²ï¼‰
  â†’ Critic-L3+L4ï¼ˆè¯„æ–‡åŒ–+æ‰¹è¯„ï¼‰
  â†’ [HITL]
  â†’ Draft-HiResï¼ˆæœ€ç»ˆæ¸²æŸ“ï¼‰
  â†’ Critic-L5ï¼ˆæœ€ç»ˆå“²å­¦è¯„å®¡ï¼‰
  â†’ Archive
```
ç‰¹ç‚¹ï¼šç»å…¸ä¸‰æ­¥æ³•ï¼ˆValue Study â†’ Color Study â†’ Renderingï¼‰ï¼Œæ¯æ­¥å¯ç‹¬ç«‹å›é€€ã€‚

---

## 6. æœ¬åœ°æ¨¡å‹éƒ¨ç½²çŸ©é˜µ

### 6.1 ç¡¬ä»¶çº¦æŸ

| é¡¹ç›® | è§„æ ¼ | é™åˆ¶ |
|------|------|------|
| GPU | RTX 2070 Max-Q 8GB VRAM | SD 1.5 + ControlNet å¯è·‘ï¼ŒSDXL å‹‰å¼º |
| RAM | 11-14GB | Agent LLM è°ƒç”¨èµ° APIï¼Œä¸å æœ¬åœ°å†…å­˜ |
| ç½‘ç»œ | WSL2 | API è°ƒç”¨éœ€è¦ç½‘ç»œ |

### 6.2 æ¨¡å‹åˆ†é…ï¼ˆv2.2 æ›´æ–° â€” DeepSeek + Gemini æ–¹æ¡ˆï¼‰

| ä»»åŠ¡ | æ¨¡å‹ | éƒ¨ç½² | VRAM | æˆæœ¬/æ¬¡ | FC | VLM | ä¼˜å…ˆçº§ |
|------|------|------|------|---------|----|----|--------|
| **æ„å›¾ç”Ÿæˆ** | SD 1.5 | æœ¬åœ° ComfyUI | 4GB | $0 | - | - | P0 |
| **é£æ ¼è¿ç§»** | IP-Adapter (SD 1.5) | æœ¬åœ° ComfyUI | +2GB | $0 | - | - | P0 |
| **å±€éƒ¨é‡ç»˜** | ControlNet canny/depth | æœ¬åœ° ComfyUI | +2GB | $0 | - | - | P0 |
| **é«˜æ¸…æ¸²æŸ“** | FLUX.1-schnell | Together.ai API | 0 | $0.003 | - | - | P0 |
| **è§†è§‰å‚è€ƒæ£€ç´¢** | CLIP ViT-B/32 | æœ¬åœ° | <1GB | $0 | - | - | P0 |
| **æ–‡æœ¬å‘é‡æ£€ç´¢** | all-MiniLM-L6 | æœ¬åœ° FAISS | <0.5GB | $0 | - | - | P0 |
| **L1/L2 VLM Agent** | **Gemini 2.5 Flash-Lite** | API (LiteLLM) | 0 | **$0.001** | âœ… | âœ… | P0 |
| **L3/L4/L5 Agent** | **DeepSeek V3.2** | API (LiteLLM) | 0 | **$0.002** | âœ… | âŒ | P0 |
| **Fallback LLM #1** | Qwen2.5-72B (DeepInfra) | API (LiteLLM) | 0 | $0.0007 | âœ… | âŒ | P0 |
| **Fallback LLM #2** | GPT-4o-mini | API (LiteLLM) | 0 | $0.0009 | âœ… | âœ… | P0 |
| **Queen Intent** | DeepSeek V3.2 | API (LiteLLM) | 0 | $0.002 | âœ… | âŒ | P0 |
| **Archivist** | DeepSeek V3.2 | API (LiteLLM) | 0 | $0.001 | - | - | P0 |
| **æœ¬åœ°è½»é‡å¤‡é€‰** | KOALA-Lightning 700M | æœ¬åœ° diffusers | 4GB | $0 | - | - | P1 |
| **ç»˜ç”»è§†è§‰åˆ†æ** | GalleryGPT | æœ¬åœ° | ~4GB | $0 | - | âœ… | P1 |

> **v2.2 å…³é”®å˜æ›´**ï¼š
> - Claude Sonnet ($0.02) â†’ DeepSeek V3.2 ($0.002)ï¼šä¾¿å®œ 10 å€ï¼Œä¸­æ–‡æ–‡åŒ–çŸ¥è¯†æ›´å¼º
> - GPT-4o-vision ($0.01) â†’ Gemini 2.5 Flash-Lite ($0.001)ï¼šæœ€ä¾¿å®œ VLM+FC
> - æ‰€æœ‰ LLM é€šè¿‡ LiteLLM ç»Ÿä¸€è·¯ç”±ï¼Œä¸€è¡Œä»£ç åˆ‡æ¢æ¨¡å‹
> - L3-L5 ä¸éœ€è¦çœ‹å›¾ï¼ˆå›¾åƒä¿¡æ¯ä» L1/L2 çš„åˆ†æç»“æœè·¨å±‚ä¼ é€’ï¼‰

### 6.3 VRAM å…±äº«ç­–ç•¥ï¼ˆ8GB é™åˆ¶ï¼‰â€” 2026-02-12 å®æµ‹æ•°æ®

```
ä¸èƒ½åŒæ—¶åŠ è½½æ‰€æœ‰æ¨¡å‹ã€‚æŒ‰é˜¶æ®µä¸²è¡Œåˆ‡æ¢ï¼ˆå®æµ‹ VRAM æ•°æ®ï¼‰ï¼š

Scout é˜¶æ®µ:     CLIP ViT-B/32 (350MB) + MiniLM (80MB)     â†’ ~0.5GB
Draft-Compose:  SD 1.5 fp16                                â†’ ~2GB
Draft-Style:    SD 1.5 + IP-Adapter (+200MB)               â†’ ~2.2GB
Draft-Refine:   SD 1.5 + ControlNet (+500MB)               â†’ ~2.5GB
Draft-HiRes:    KOALA-Lightning 700M                       â†’ ~5.7GBï¼ˆæˆ– FLUX API 0GBï¼‰
Critic:         GalleryGPT 4-bit (LLaVA 7B NF4)           â†’ ~4.3GBï¼ˆæˆ– Gemini API 0GBï¼‰

åˆ‡æ¢ç­–ç•¥ï¼šæ¯é˜¶æ®µå¼€å§‹æ—¶ gc.collect() + torch.cuda.empty_cache()ã€‚
å…³é”®çº¦æŸï¼šDraft å’Œ Critic é˜¶æ®µä¸èƒ½åŒæ—¶è¿è¡Œï¼Œå¿…é¡»ä¸²è¡Œã€‚
TDR è¶…æ—¶ï¼šWindows æ³¨å†Œè¡¨ TdrDelay=60, TdrDdiDelay=60ï¼ˆé»˜è®¤ 2s ä¼šæ€æ­» GPU é•¿ä»»åŠ¡ï¼‰ã€‚
```

---

## 7. æˆæœ¬æ¨¡å‹ï¼ˆv2 æ›´æ–°ï¼‰

### 7.0 Step 2 å·²éªŒè¯åŸºçº¿ï¼ˆçœŸå®æ•°æ®ï¼‰

> æ¥æºï¼š`step2-phase3-summary.md`ï¼ˆé«˜å¯ä¿¡åº¦ï¼‰
>
> | æŒ‡æ ‡ | å€¼ |
> |------|-----|
> | Together FLUX çœŸå®è¿è¡Œ | 320 tasks, 90% pass |
> | P95 æ—¶å»¶ | ~10.7s |
> | å• task æˆæœ¬ | $0.0132ï¼ˆå«å›¾åƒç”Ÿæˆ $0.003 + å…¶ä»–å¼€é”€ï¼‰ |

### 7.1 å•æ ·ä¾‹æˆæœ¬åˆ†è§£ï¼ˆv2.2 â€” DeepSeek + Gemini æ–¹æ¡ˆï¼‰â˜… ä¼°ç®—

| é˜¶æ®µ | ç»„ä»¶ | è°ƒç”¨æ¬¡æ•° | å•ä»· | å°è®¡ | å¤‡æ³¨ |
|------|------|---------|------|------|------|
| **Queen-Intent** | DeepSeek V3.2 | 1 | $0.002 | **$0.002** | æ„å›¾è§£æ â†’ IntentCardV2 |
| Scout | CLIP + FAISS | 1 | $0 | $0 | æœ¬åœ° |
| Scout-L5 | DeepSeek V3.2 | 1 | $0.002 | $0.002 | ~300 token å“²å­¦æ‘˜è¦ |
| Draft-Compose | SD 1.5 æœ¬åœ° | 4 å›¾ | $0 | $0 | ComfyUI |
| Draft-Style | IP-Adapter æœ¬åœ° | 4 å›¾ | $0 | $0 | ComfyUI |
| Critic-Rule | è§„åˆ™å¼•æ“ | 1 | $0 | $0 | ç¡¬é—¨ç¦ï¼Œå¿…è·‘ |
| **Critic-L3** | **DeepSeek V3.2** (ReAct) | 1 | **$0.002** | **$0.002** | **å¿…è·‘**ï¼Œ2-3 è½®å·¥å…·è°ƒç”¨ |
| **Critic-L5** | **DeepSeek V3.2** (ReAct) | 1 | **$0.002** | **$0.002** | **å¿…è·‘**ï¼Œ2-4 è½®å·¥å…·è°ƒç”¨ |
| Critic-L1/L2 | Gemini Flash-Lite (ReAct) | ~0.5 | $0.001 | ~$0.001 | **æŒ‰éœ€å‡çº§**ï¼ˆVLMï¼Œå‡æ‘Šï¼‰ |
| Critic-L4 | DeepSeek V3.2 (ReAct) | ~0.3 | $0.002 | ~$0.001 | **æŒ‰éœ€å‡çº§**ï¼ˆå‡æ‘Šï¼‰ |
| Draft-HiRes | FLUX API | 1 | $0.003 | $0.003 | Step 2 å·²éªŒè¯ |
| **Queen-Decision** | è§„åˆ™å†³ç­–æ ‘ | 1 | $0 | **$0** | v2.2 ä¿ç•™è§„åˆ™ï¼ˆé›¶æˆæœ¬ï¼‰ |
| Archivist | DeepSeek V3.2 | 1 | $0.001 | $0.001 | æ–‡æœ¬æ•´ç† |
| **æ€»è®¡ï¼ˆ1 è½®ï¼Œæ··åˆæ¨¡å¼ï¼‰** | | | | **~$0.008ï¼ˆä¼°ç®—ï¼‰** | â˜… **èŠ‚çœ 91%**ï¼ˆæ—§ $0.086ï¼‰ |
| **æ€»è®¡ï¼ˆ1 è½®ï¼Œå…¨é‡ LLMï¼‰** | | | | **~$0.012** | L1-L5 å…¨éƒ¨ Agent |
| **æ€»è®¡ï¼ˆ1 è½®ï¼Œé€‰æ‹©æ€§å‡çº§ï¼‰** | | | | **~$0.004** | ä»… L3+L5 Agent |
| **æ€»è®¡ï¼ˆ2 è½®ï¼Œå«å±€éƒ¨é‡ç»˜ï¼‰** | | | | **~$0.02-$0.03** | |
| **æ€»è®¡ï¼ˆ3 è½®ï¼Œä¸Šé™ï¼‰** | | | | **~$0.05** | |

> æ³¨ï¼šæœ¬èŠ‚ä¸ºè§„åˆ’ä¼°ç®—ã€‚é™¤ FLUX åŸºçº¿ï¼ˆStep 2ï¼‰å¤–ï¼Œå…¶ä½™ LLM æˆæœ¬éœ€åœ¨ Phase C æ¥çº¿åæŒ‰çœŸå® token è´¦å•å›å¡«ã€‚

#### 7.1.1 æ–°æ—§æ–¹æ¡ˆå¯¹æ¯”

| åœºæ™¯ | æ—§æ–¹æ¡ˆ (Claude) | æ–°æ–¹æ¡ˆ (DeepSeek) | èŠ‚çœ |
|------|-----------------|-------------------|------|
| æ··åˆæ¨¡å¼ 1 è½® | $0.086 | **$0.008** | **91%** |
| å…¨é‡ LLM 1 è½® | $0.116 | $0.012 | 90% |
| é€‰æ‹©æ€§å‡çº§ | $0.040-0.060 | $0.004 | 93% |
| 2 è½®å«å±€éƒ¨é‡ç»˜ | $0.14-0.19 | $0.02-0.03 | 85% |
| 20 æ ·ä¾‹å›å½’ | $1.72 | **$0.16** | 91% |
| **æ—¥é¢„ç®— $5 è¦†ç›–** | **25-58 æ¬¡** | **500-1250 æ¬¡** | **20x+** |

### 7.2 é¢„ç®—æŠ¤æ ï¼ˆv2.2 è°ƒæ•´ï¼‰

```
MAX_ROUNDS = 3            # v1 æ˜¯ 2ï¼Œv2 å¢åŠ  1 è½®å±€éƒ¨é‡ç»˜ä½™é‡
MAX_COST_PER_TASK = $0.05 # â˜… v2.2 ä¸‹è°ƒï¼ˆæ—§ $0.20ï¼‰ï¼Œæ¨¡å‹æˆæœ¬å¤§é™
DAILY_BUDGET = $5         # ä¸å˜ï¼ˆä½†è¦†ç›–æ¬¡æ•° 20x+ï¼‰
MAX_DRAFT_PER_ROUND = 4   # v1 æ˜¯ 6ï¼Œv2 å‡å°‘ï¼ˆå±€éƒ¨é‡ç»˜æ›´ç²¾ç¡®ï¼‰
EARLY_STOP_THRESHOLD = 0.75 # v1 æ˜¯ 0.8ï¼ŒLLM è¯„åˆ†æ›´ä¸¥æ ¼
ACCEPT_THRESHOLD = 0.55   # v1 æ˜¯ 0.6ï¼ŒLLM è¯„åˆ†æ›´ä¸¥æ ¼
BUDGET_PER_LAYER_ENABLED = True  # â˜… v2.2 æ–°å¢ï¼šæŒ‰å±‚åˆ†è´¦
```

---

## 8. æ‰§è¡Œè®¡åˆ’ï¼ˆv2 åˆ†é˜¶æ®µï¼‰

> **Phase é¡ºåºè°ƒæ•´è¯´æ˜**ï¼ˆåŸºäºè·¯çº¿å¤æ ¸ 2026-02-10ï¼‰ï¼š
> åŸç‰ˆ v2 å°† LLM Critic æ”¾åœ¨ Phase Aï¼Œä½†å®¡è®¡å»ºè®®è°ƒæ•´ä¸ºï¼š
> 1. **å…ˆåšå±€éƒ¨é‡ç»˜ï¼ˆComfyUIï¼‰** â€” æœ€å¿«æŠŠ"è®¾è®¡å¸ˆå·¥ä½œæµ"ä»æ¦‚å¿µå˜æˆå¯è§ç»“æœï¼ˆç”¨æˆ·ä»·å€¼æœ€é«˜ï¼‰
> 2. **å†åšè¯­ä¹‰æ£€ç´¢ï¼ˆFAISSï¼‰** â€” ä¸º Critic æä¾›é«˜è´¨é‡é”šå®šè¯æ®ï¼Œé¿å… LLM è¯„åˆ†æ¼‚ç§»
> 3. **æœ€åå‡çº§ LLM Critic** â€” æœ‰é”šå®šæ•°æ®æ”¯æ’‘æ—¶ LLM è¯„åˆ†æ›´ç¨³å®šï¼Œä¸”å¯åš selective escalation æ§æˆæœ¬

### Phase 0: çŠ¶æ€ç»Ÿä¸€ä¸åŸºçº¿ç¡®è®¤ï¼ˆ2 å¤©ï¼‰â€” å‰ç½®å¿…åš

è§£å†³æ–‡æ¡£å†²çªä¸çº¿ä¸ŠçŠ¶æ€ä¸ç¡®å®šæ€§ã€‚

| Day | ç›®æ ‡ | äº¤ä»˜ | Gate |
|-----|------|------|------|
| D0 | ç»Ÿä¸€"å•ä¸€çœŸç›¸æ–‡æ¡£"ï¼šåˆå¹¶ D14/Step2/Step3 å†²çªå£å¾„ | `docs/prototype-status-baseline.md` | ä¸€ä»½æ— æ­§ä¹‰çš„ç°çŠ¶æ–‡æ¡£ |
| D1 | çº¿ä¸ŠçŠ¶æ€å¤æµ‹ï¼šéªŒè¯ `/api/v1/prototype/*` æ˜¯å¦å·²éƒ¨ç½² | å¤æµ‹æŠ¥å‘Š | ç¡®è®¤çº¿ä¸Šå¯ç”¨/ä¸å¯ç”¨çŠ¶æ€ |

**Gate 0**ï¼šæ¶ˆé™¤"D14 mock å£å¾„ vs Step2 real å£å¾„ vs Step3 local GO + online NO-GO"çš„ç‰ˆæœ¬å å±‚å†²çªã€‚

### Phase A: æœ¬åœ°ç”Ÿæˆ + å±€éƒ¨é‡ç»˜ï¼ˆ5 å¤©ï¼‰â€” âœ… æ ¸å¿ƒå®Œæˆï¼ˆ2026-02-10ï¼‰

> **å®é™…æ–¹æ¡ˆ**ï¼šæ”¾å¼ƒ ComfyUIï¼ˆé¢å¤–è¿›ç¨‹ç®¡ç†å¤æ‚ï¼‰ï¼Œé‡‡ç”¨ `diffusers` API ç›´æ¥é›†æˆã€‚
> SD 1.5 txt2img + AutoPipelineForInpaintingï¼Œæ›´è½»é‡ç›´æ¥ã€‚
> IP-Adapter / ControlNet depth ä¸ºè¿›é˜¶æ‰©å±•ï¼Œå½“å‰æ ¸å¿ƒè·¯å¾„å·²é—­åˆã€‚

å·²äº¤ä»˜ï¼š
- âœ… `DiffusersProvider`ï¼šSD 1.5 æœ¬åœ° txt2imgï¼ˆ`draft_provider.py`ï¼‰
- âœ… `DiffusersInpaintProvider`ï¼šSD 1.5 æœ¬åœ° inpaintingï¼ˆ`inpaint_provider.py`ï¼‰
- âœ… `MaskGenerator`ï¼šL1-L5 â†’ ç©ºé—´ç­–ç•¥æ˜ å°„ï¼ˆfull/centre/foreground/upper/diffuseï¼‰
- âœ… `DraftAgent.refine_candidate()`ï¼šå±€éƒ¨é‡ç»˜æ–¹æ³•
- âœ… `orchestrator.rerun_local`ï¼šQueen â†’ æ‰¾æœ€ä½³å€™é€‰ â†’ mask â†’ inpaint â†’ å› Critic é‡è¯„
- âœ… 30/30 éªŒè¯ï¼ˆ28 mock + 2 GPU å®æµ‹ï¼‰ï¼Œ18/18 pytest é›¶å›å½’
- âœ… GPU å®æµ‹ï¼š3.8s / 15æ­¥ / 512Ã—512 / 2.0GB VRAM / $0

æœªå®Œæˆï¼ˆè¿›é˜¶æ‰©å±•ï¼Œéé˜»å¡ï¼‰ï¼š
- âŒ IP-Adapter é£æ ¼è¿ç§»ï¼ˆDraft-Styleï¼‰
- âŒ ControlNet canny/depth æ¡ä»¶æ§åˆ¶
- âŒ Draft 4 å­ Agent ä¸²è”ï¼ˆComposeâ†’Styleâ†’Refineâ†’HiResï¼‰
- âŒ 10 æ ·ä¾‹è§†è§‰è´¨é‡å›å½’

**Gate A**ï¼šâœ… é€šè¿‡ï¼ˆdiffusers SD 1.5 inpaint + MaskGenerator + orchestrator rerun_localï¼Œ30/30 éªŒè¯ï¼‰ã€‚
å…³é”®è®¾è®¡å†³ç­–ï¼šä½¿ç”¨ `runwayml/stable-diffusion-v1-5`ï¼ˆsafetensorsï¼‰è€Œé `runwayml/stable-diffusion-inpainting`ï¼ˆä»… pickle æƒé‡ï¼Œè¢« CVE-2025-32434 é˜»æ­¢ï¼‰ã€‚

### Phase B: Scout FAISS è¯­ä¹‰é”šå®šï¼ˆ5 å¤©ï¼‰

> è°ƒæ•´ç†ç”±ï¼šå…ˆæœ‰é«˜è´¨é‡é”šå®šè¯æ®ï¼ŒLLM Critic æ‰èƒ½ç»™å‡ºå¯é è¯„åˆ†ï¼ˆé¿å…æ¼‚ç§»ï¼‰ã€‚
> ä¿ç•™ç°æœ‰æœ¯è¯­/ç¦åŒºè§„åˆ™ä½œä¸º deterministic safety å±‚ã€‚

è®©è¯æ®æ”¶é›†ä» Jaccard åŒ¹é…å‡çº§ä¸ºå‘é‡è¯­ä¹‰æ£€ç´¢ã€‚

| Day | ç›®æ ‡ | äº¤ä»˜ | Gate |
|-----|------|------|------|
| D7 | CLIP + FAISS å‘é‡ç´¢å¼•æ„å»º | è§†è§‰å‚è€ƒæ£€ç´¢ | Top-5 ç›¸ä¼¼åº¦å¯ç”¨ |
| D8 | æ–‡æœ¬å‘é‡æ£€ç´¢æ¥å…¥ï¼ˆall-MiniLM-L6ï¼‰ | æ–‡åŒ–æœ¯è¯­è¯­ä¹‰æ£€ç´¢ | è¾“å…¥æ„å¢ƒâ†’è¾“å‡ºç›¸å…³æœ¯è¯­ |
| D9 | Scout-L5 å“²å­¦å®šé”š LLM + Queen Intent è§£æ | ç¾å­¦æºæµæ‘˜è¦ + Intent Card | è‡ªç„¶è¯­è¨€â†’ç»“æ„åŒ– JSON |
| D10 | æ£€ç´¢è´¨é‡è¯„ä¼°ï¼šFAISS vs Jaccard å¯¹æ¯” | æ£€ç´¢è´¨é‡æŠ¥å‘Š | å¯è§£é‡Šï¼ˆsource/snippet/idï¼‰|
| D11 | 10 æ ·ä¾‹ Scout å›å½’ | æ£€ç´¢è´¨é‡åŸºçº¿ | Gate B éªŒæ”¶ |

**Gate B**ï¼ˆé‡åŒ–é—¨æ§›ï¼‰ï¼š
- FAISS æ£€ç´¢ Recall@5 â‰¥ 60%ï¼ˆäººå·¥æ ‡æ³¨ 10 æ ·ä¾‹çš„ ground-truth ç›¸å…³é›†ï¼‰
- Top-1 Hit Rate æ¯” Jaccard baseline æå‡ â‰¥ 15 ä¸ªç™¾åˆ†ç‚¹
- æ¯æ¡æ£€ç´¢ç»“æœé™„ source/snippet/idï¼Œå¯è¿½æº¯

### Phase B': Agent åŸºç¡€è®¾æ–½ï¼ˆä¸ Phase B å¹¶è¡Œï¼‰â€” â³ è¿›è¡Œä¸­ï¼ˆåŸºç¡€è®¾æ–½å·²è½åœ°ï¼‰

> **çŠ¶æ€**ï¼šPhase B' å·²å®Œæˆâ€œæ–‡ä»¶çº§è½åœ°â€ï¼Œå°šæœªå®Œæˆâ€œä¸»é“¾æ¥çº¿éªŒè¯â€ã€‚
> æ­¤é˜¶æ®µå»ºç«‹ ReAct Agent æ‰€éœ€åŸºç¡€è®¾æ–½ï¼Œä¸º Phase C æ¥çº¿æä¾›ç»„ä»¶ã€‚

| ç»„ä»¶ | æ–‡ä»¶ | çŠ¶æ€ | éªŒè¯ |
|------|------|------|------|
| **LayerState çŠ¶æ€æœº** | `agents/layer_state.py` | âœ… å·²å®ç° | è¯­æ³•/å¯¼å…¥é€šè¿‡ |
| **IntentCardV2** | `agents/layer_state.py` | âœ… å·²å®ç° | å« target_profile, must_pass_layers |
| **CrossLayerSignal** | `agents/layer_state.py` | âœ… å·²å®ç° | reinterpret/unlock/boost/suppress |
| **LocalRerunRequest** | `agents/layer_state.py` | âœ… å·²å®ç° | mask_specs + preserve_layers |
| **ToolRegistry** | `agents/tool_registry.py` | âœ… å·²å®ç° | 5 å·¥å…· schema + executor |
| **ModelRouter** | `agents/model_router.py` | âœ… å·²å®ç° | 4 æ¨¡å‹ + Fallback Chain |
| **AgentRuntime** | `agents/agent_runtime.py` | âœ… å·²å®ç° | ReAct å¾ªç¯ + LiteLLM |
| **PlanState v2** | `agents/queen_types.py` | âœ… å·²å‡çº§ | layer_states + intent_card |
| **BudgetState v2** | `agents/queen_types.py` | âœ… å·²å‡çº§ | llm_calls + tool_calls |

**Gate B'**ï¼šâœ… **å®Œæˆ**ï¼ˆ2026-02-10ï¼‰
- âœ… åŸºç¡€æ–‡ä»¶è½åœ°ï¼šLayerState / ToolRegistry / ModelRouter / AgentRuntime
- âœ… æ•°æ®ç»“æ„å‘åå…¼å®¹ï¼šPlanState / BudgetState æ‰©å±•ä¸ç ´åç°æœ‰ä¸»é“¾
- âœ… ä¸»é“¾æ¥çº¿å®Œæˆï¼š`orchestrator.py` é€šè¿‡ `enable_agent_critic` è°ƒç”¨ `CriticLLM` â†’ `AgentRuntime`
- âœ… åŠŸèƒ½é—­ç¯å®Œæˆï¼š`critic_llm.py` åˆ›å»ºã€tools ä¼ é€’ä¿®å¤ã€LLM 25/25 éªŒè¯é€šè¿‡

### Phase C: Critic ReAct Agent å‡çº§ï¼ˆ5 å¤©ï¼‰â˜…â˜…â˜… â€” âœ… æ ¸å¿ƒå®Œæˆï¼ˆ2026-02-10ï¼‰

> å®é™…äº¤ä»˜ï¼šCriticLLM æ¡¥æ¥å±‚ + Two-Phase ReAct + DeepSeek V3.2 å®æµ‹ 25/25
> æ¨¡å‹ä» Claude Sonnet ($0.02) åˆ‡æ¢ä¸º DeepSeek V3.2 ($0.002)ï¼ŒèŠ‚çœ 91%

å·²äº¤ä»˜ï¼š
- âœ… `critic_llm.py`ï¼ˆ~260 è¡Œï¼‰ï¼šè§„åˆ™åŸºçº¿ â†’ LayerState å‡çº§ â†’ AgentRuntime ReAct
- âœ… GAP 1/3/4/7 å…¨éƒ¨ä¿®å¤ï¼ˆtools ä¼ é€’ã€æ—¥å¿—ã€LayerState å†™å›ã€locked_layersï¼‰
- âœ… orchestrator é›†æˆï¼ˆ`enable_agent_critic` å‚æ•°ï¼‰
- âœ… Two-Phase ReActï¼ˆexploration â†’ forced submissionï¼‰
- âœ… 28/28 mock + 25/25 with-LLM éªŒè¯
- âœ… Agent-ness æŒ‡æ ‡ï¼šescalation_rate 40%, tool_calls 24, re_plan_rate 100%

æœªå®Œæˆï¼ˆè¿›é˜¶ç›®æ ‡ï¼‰ï¼š
- âŒ L1/L2 VLM Agentï¼ˆGemini Flash-Liteï¼‰â€” éœ€ GOOGLE_API_KEY
- âŒ æ¸è¿›æ·±åŒ– L1â†’L2â†’...â†’L5 ä¸²è¡Œï¼ˆå½“å‰æŒ‰ä¼˜å…ˆçº§é€‰æœ€å¤š 3 dim å‡çº§ï¼‰
- âŒ CrossLayerSignal å®é™…æ‰§è¡Œï¼ˆæ•°æ®ç»“æ„æœ‰ï¼Œé€»è¾‘æœªæ¥å…¥ï¼‰
- âŒ åŠ¨æ€æƒé‡è®¡ç®—ï¼ˆä»ç”¨å›ºå®šæƒé‡ï¼‰
- âŒ ç›²è¯„å¯¹ç…§å®éªŒï¼ˆAgent èƒœç‡ â‰¥ 60%ï¼‰
- âŒ L3 Spearman Ï â‰¥ 0.5 éªŒè¯

#### Phase C æ¥å…¥æ¶æ„ï¼ˆå‚è§ FC æ¶æ„æ–‡æ¡£ Â§3.1/Â§3.3ï¼‰

```
æ–°å¢æ–‡ä»¶ï¼ˆPhase B' å·²å®Œæˆ âœ…ï¼‰ï¼š
  agents/agent_runtime.py   â€” ç»Ÿä¸€ ReAct æ‰§è¡Œå¾ªç¯
  agents/tool_registry.py   â€” å·¥å…· schema + executor æ³¨å†Œ
  agents/model_router.py    â€” æŒ‰å±‚/é¢„ç®—/ç½®ä¿¡åº¦é€‰æ¨¡å‹

å¾…æ–°å¢æ–‡ä»¶ï¼ˆPhase C å®ç°ï¼‰ï¼š
  agents/critic_llm.py      â€” â˜… æ¡¥æ¥å±‚ï¼šAgentRuntime â†” Orchestrator
                              å°è£…"é€‰æ‹©æ€§å‡çº§"é€»è¾‘ï¼š
                              å…ˆè·‘ CriticRulesï¼ˆç¡¬é—¨ç¦ï¼‰ï¼Œ
                              å†åˆ¤æ–­ LayerState.priority() æ˜¯å¦è§¦å‘ Agentï¼Œ
                              æ˜¯ â†’ AgentRuntime.evaluate()
                              å¦ â†’ ç›´æ¥ç”¨è§„åˆ™åˆ†æ•°

Orchestrator æ¥å…¥ç‚¹ï¼ˆæ”¹é€  orchestrator.pyï¼‰ï¼š
  Critic é˜¶æ®µï¼šå…ˆè·‘è§„åˆ™ â†’ critic_llm.py é€‰æ‹©æ€§å‡çº§ â†’ å†™å…¥ LayerState
  Queen é˜¶æ®µï¼šè¯»å– LayerState åš rerun_local / rerun_global åˆ†æµ
  Scout é˜¶æ®µï¼šï¼ˆå¯é€‰ï¼‰è½¬ä¸º ScoutAgentRuntimeï¼ˆå…è®¸åŠ¨æ€æ£€ç´¢è¡¥è¯æ®ï¼‰
```

| Day | ç›®æ ‡ | äº¤ä»˜ | Gate |
|-----|------|------|------|
| D12 | **critic_llm.py æ¡¥æ¥å±‚** + AgentRuntime æ¥å…¥ Orchestrator + L3 Agent è·‘é€š DeepSeek V3.2 | `critic_llm.py` + L3 Agent ç«¯åˆ°ç«¯ | L3 Agent vs è§„åˆ™è¯„åˆ†å¯¹æ¯” |
| D13 | L5 Agent + è·¨å±‚æ¨ç†ï¼ˆread_layer_analysisï¼‰+ CrossLayerSignal åå“º + é€‰æ‹©æ€§å‡çº§åˆ¤æ–­ | L3/L5 Agent å¯äº§ç”Ÿè·¨å±‚ä¿¡å· | L5 Agent å¯ç”¨ + reinterpret è§¦å‘ |
| D14 | L1/L2 Gemini Flash-Lite VLM Agent + æ¸è¿›æ·±åŒ–ä¸²è¡Œï¼ˆL1â†’L2â†’L3â†’L4â†’L5ï¼‰ | 5 å±‚ Agent ä¸²è¡Œ | æ¯å±‚ read_layer_analysis å‰å±‚ |
| D15 | åŠ¨æ€æƒé‡ + æˆæœ¬æŠ¤æ  + `validate_critic_llm.py` éªŒè¯è„šæœ¬ | åŠ¨æ€æƒé‡ + éªŒè¯æŠ¥å‘Š | è¯„åˆ†å¯è§£é‡Šã€Agent æŒ‰éœ€è§¦å‘ |
| D16 | 10 æ ·ä¾‹ Agent Critic å›å½’ï¼ˆå« AgentResult + Agent-ness æŒ‡æ ‡ï¼‰ | æˆæœ¬/è´¨é‡/æ—¶å»¶åŸºçº¿ | Gate C éªŒæ”¶ |

**Gate C**ï¼ˆé‡åŒ–é—¨æ§› â€” v2.2 æ›´æ–°ï¼Œèåˆ FC æ¶æ„æ–‡æ¡£ Â§6 éªŒæ”¶æŒ‡æ ‡ï¼‰ï¼š
- 10 æ ·ä¾‹ A/B å¯¹æ¯”ï¼šReAct Agent vs çº¯è§„åˆ™ Criticï¼ŒAgent æ–¹èƒœç‡ â‰¥ 60%ï¼ˆäººå·¥ç›²è¯„ï¼‰
- L3 ç»´åº¦ï¼šAgent è¯„åˆ†ä¸äººå·¥æ ‡æ³¨ç›¸å…³ç³»æ•° â‰¥ 0.5ï¼ˆSpearman Ïï¼‰
- å•æ ·ä¾‹ Critic æˆæœ¬ â‰¤ **$0.01**ï¼ˆâ˜… v2.2 ä¸‹è°ƒï¼Œæ—§ $0.08ï¼Œå› æ¨¡å‹åˆ‡æ¢èŠ‚çœ 91%ï¼‰
- **Agent-ness å››é¡¹æŒ‡æ ‡**ï¼ˆè¯æ˜ä¸æ˜¯"åƒµç¡¬ç³»ç»Ÿ"ï¼‰ï¼š
  - Tool-autonomy rate â‰¥ 70%ï¼ˆLLM è‡ªä¸»é€‰å·¥å…·ï¼Œéå›ºå®šæ¨¡æ¿ï¼‰
  - Re-plan rate â‰¥ 40%ï¼ˆæ£€ç´¢åæ”¹å˜ä¸‹ä¸€æ­¥è¡Œä¸ºï¼‰
  - å¹³å‡ tool_calls â‰¥ 2/å±‚ï¼ˆAgent çœŸæ­£ä½¿ç”¨å·¥å…·ï¼‰
  - L3/L5 quality gain â‰¥ 60%ï¼ˆå¯¹æ¯”è§„åˆ™ one-shot ç›²è¯„èƒœç‡ï¼‰
- æˆæœ¬æ€»é¢åœ¨æ—¥é¢„ç®— $5 æŠ¤æ å†…ï¼ˆ20 æ ·ä¾‹ â‰¤ $0.20ï¼‰

### Phase D: æ–‡åŒ–è·¯ç”± + å…¨é“¾è·¯å›å½’ + å°ç‰ˆï¼ˆ5 å¤©ï¼‰

| Day | ç›®æ ‡ | äº¤ä»˜ | Gate |
|-----|------|------|------|
| D17 | ä¸­å›½å†™æ„ç®¡é“å®è£… | ç¬¬ 1 æ¡æ–‡åŒ–å˜ä½“ | èµ°å·®å¼‚åŒ–æƒé‡+æµç¨‹ |
| D18 | è¥¿æ–¹å­¦é™¢æ´¾ç®¡é“å®è£… | ç¬¬ 2 æ¡æ–‡åŒ–å˜ä½“ | ä¸‰æ­¥é€’è¿›å¯ç”¨ |
| D19 | 20 æ ·ä¾‹å…¨é“¾è·¯å›å½’ï¼ˆ3 ç®¡é“ï¼‰ | å®Œæ•´å›å½’æŠ¥å‘Š | é€šè¿‡ç‡ â‰¥ 70% |
| D20 | Langfuse è§‚æµ‹ + å‰ç«¯ Critic è¯¦æƒ…å±•ç¤º | æˆæœ¬è¿½è¸ª + L1-L5 è¯æ® UI | å¯è§†åŒ–å®Œæ•´ |
| D21 | å°ç‰ˆ + æ€»ç»“æ–‡æ¡£ | v2 æ€»ç»“åŒ… | Gate D éªŒæ”¶ |

**Gate D**ï¼š20 æ ·ä¾‹ç«¯åˆ°ç«¯ Ã— 3 ç®¡é“ï¼Œæˆæœ¬/è´¨é‡/æ—¶å»¶å¯é‡åŒ–ã€‚

---

## 9. v2 DoDï¼ˆDefinition of Doneï¼‰â€” v2.2 æ›´æ–°

| æŒ‡æ ‡ | é—¨æ§› | æµ‹é‡æ–¹å¼ |
|------|------|----------|
| 20 æ ·ä¾‹ E2E | å…¨éƒ¨å¯è¿è¡Œ | å›å½’è„šæœ¬ |
| L3/L5 ReAct Agent è¯„å®¡ | å¿…è·‘ Agentï¼ˆéè§„åˆ™ï¼‰| Langfuse trace / AgentResult |
| L1/L2/L4 é€‰æ‹©æ€§å‡çº§ | ä½ç½®ä¿¡æ—¶è‡ªåŠ¨è§¦å‘ Agent | è§¦å‘ç‡ç»Ÿè®¡ |
| **Agent-ness: Tool-autonomy** | **â‰¥ 70%** è½®æ¬¡ LLM è‡ªä¸»é€‰å·¥å…· | AgentResult æ—¥å¿—åˆ†æ |
| **Agent-ness: Re-plan** | **â‰¥ 40%** è½®æ¬¡æ£€ç´¢åæ”¹è®¡åˆ’ | AgentResult æ—¥å¿—åˆ†æ |
| **Agent-ness: tool_calls** | **â‰¥ 2/å±‚** å¹³å‡å·¥å…·è°ƒç”¨ | AgentResult.tool_calls_made |
| æ··åˆ Critic å¢ç›Š | Agent æ–¹èƒœç‡ â‰¥ 60%ï¼ˆ10 æ ·ä¾‹ç›²è¯„ï¼‰ | A/B å¯¹æ¯”æŠ¥å‘Š |
| å±€éƒ¨é‡ç»˜å¯ç”¨ | â‰¥ 1 ç§æ–¹æ³• | ComfyUI inpaint |
| FAISS æ£€ç´¢è´¨é‡ | Recall@5 â‰¥ 60%ï¼ŒTop-1 æ¯” Jaccard æå‡ â‰¥ 15pp | æ£€ç´¢å¯¹æ¯”æŠ¥å‘Š |
| æ–‡åŒ–è·¯ç”± | â‰¥ 3 æ¡ç®¡é“ | é»˜è®¤/å†™æ„/å­¦é™¢æ´¾ |
| å·²ç¡®è®¤ç»´åº¦ä¿ç•™ç‡ | â‰¥ 95% | checkpoint diff |
| å±€éƒ¨é‡ç»˜æˆæœ¬æ¯” | â‰¤ 40%ï¼ˆvs å…¨é‡é‡è·‘ï¼‰ | æˆæœ¬æ—¥å¿— |
| **å•æ ·ä¾‹æˆæœ¬ï¼ˆæ··åˆæ¨¡å¼ï¼‰** | **â‰¤ $0.01** | Langfuse / ModelRouter.budget |
| **å•æ ·ä¾‹æˆæœ¬ï¼ˆå…¨é‡ Agentï¼‰** | **â‰¤ $0.02** | Langfuse / ModelRouter.budget |
| **å•æ ·ä¾‹æˆæœ¬ï¼ˆä¸Šé™ 3 è½®ï¼‰** | **â‰¤ $0.05** | Langfuse / ModelRouter.budget |
| P95 æ—¶å»¶ | â‰¤ 120s | ç«¯åˆ°ç«¯åŸ‹ç‚¹ |
| Fallback å¯ç”¨æ€§ | ä¸»æ¨¡å‹ä¸å¯ç”¨æ—¶è‡ªåŠ¨é™çº§ | æ•…éšœæ³¨å…¥æµ‹è¯• |

> **v2.2 æˆæœ¬æŒ‡æ ‡å¤§å¹…ä¸‹è°ƒ**ï¼šæ—§ DoD $0.12-$0.20 â†’ æ–° DoD **$0.01-$0.05**ï¼ˆå› æ¨¡å‹åˆ‡æ¢èŠ‚çœ 91%ï¼‰

---

## 10. é£é™©æ§åˆ¶ï¼ˆv2.2 æ›´æ–°ï¼‰

| é£é™© | ä¸¥é‡åº¦ | ç¼“è§£ |
|------|--------|------|
| 8GB VRAM ä¸å¤Ÿ ComfyUI + ControlNet | ğŸŸ  | é˜¶æ®µåˆ‡æ¢ç­–ç•¥ï¼›FLUX ä½œä¸ºäº‘ç«¯å¤‡é€‰ï¼ˆStep 2 å·²éªŒè¯ï¼‰ |
| ComfyUI æœ¬åœ°å®‰è£…å›°éš¾ï¼ˆWSL2ï¼‰ | ğŸŸ  | ä¼˜å…ˆè·‘é€š txt2imgï¼Œå†é€æ­¥åŠ  ControlNetï¼›é™çº§åˆ° FLUX API |
| Agent è¯„åˆ†ä¸è§„åˆ™è¯„åˆ†å·®å¼‚å¤§ | ğŸŸ¡ | Phase C å…ˆåš 10 æ ·ä¾‹å¯¹æ¯”æ ¡å‡†ï¼›é€‰æ‹©æ€§å‡çº§æ§åˆ¶çˆ†ç‚¸åŠå¾„ |
| Agent ä¸è°ƒå·¥å…·ç›´æ¥è¾“å‡ºåˆ†æ•° | ğŸŸ¡ | System Prompt å¼ºåˆ¶è¦æ±‚è°ƒå·¥å…·ï¼›Gate C æ£€æŸ¥ tool_calls â‰¥ 2 |
| DeepSeek V3.2 API ä¸å¯ç”¨/é™æµ | ğŸŸ¡ | Fallback Chain: DeepSeek â†’ Qwen â†’ GPT-4o-mini â†’ è§„åˆ™å¼•æ“ |
| LLM è¯„åˆ†æ¼‚ç§»ï¼ˆæ— é”šå®šï¼‰ | ğŸŸ¡ | Phase B å…ˆå®Œæˆ FAISS é”šå®šï¼ŒPhase C å†æ¥ Agentï¼ˆæœ‰è¯æ®æ”¯æ’‘ï¼‰ |
| LiteLLM å…¼å®¹æ€§é—®é¢˜ | ğŸŸ¢ | å·²éªŒè¯ DeepSeek/Gemini/Qwen/GPT-4o-mini å››å®¶ API |
| æ–‡åŒ–è·¯ç”±å¢åŠ å¤æ‚åº¦ | ğŸŸ¢ | Phase D åšï¼Œå¯é™çº§ï¼šé»˜è®¤ç®¡é“ + ä»…æƒé‡å·®å¼‚åŒ–æ›¿ä»£ |
| æ–‡æ¡£å†²çªå½±å“æ±‡æŠ¥å¯ä¿¡åº¦ | ğŸŸ¢ | Phase 0 å¼ºåˆ¶ç»Ÿä¸€æ–‡æ¡£åŸºçº¿ï¼Œæ¶ˆé™¤ç‰ˆæœ¬å å±‚ |
| ~~å¤š LLM æˆæœ¬è¶…é¢„ç®—~~ | ~~ğŸŸ¡~~ | â˜… **å·²æ¶ˆé™¤**ï¼šæ¨¡å‹åˆ‡æ¢åæ—¥é¢„ç®—è¦†ç›– 500-1250 æ¬¡ï¼ˆæ—§ 25-58 æ¬¡ï¼‰ |

---

## 11. v1 â†’ v2 è¿ç§»ç­–ç•¥ï¼ˆv2.2 æ›´æ–°ï¼‰

**åŸåˆ™ï¼šä¸é‡å†™ï¼Œæ¸è¿›å¢å¼ºã€‚æŒ‰ Phase é¡ºåºé€æ­¥å åŠ ã€‚**

**Phase 0 â€” æ–‡æ¡£ç»Ÿä¸€**ï¼š
1. åˆå¹¶ D14/Step2/Step3 çš„å†²çªè¡¨è¿°ä¸º `docs/prototype-status-baseline.md`
2. å¤æµ‹çº¿ä¸ŠçŠ¶æ€ï¼Œå›ºå®š"å½“å‰çŠ¶æ€ + å·²éªŒè¯è¾¹ç•Œ + æœªå®ç°é¡¹"

**Phase A â€” Draft å¢å¼º**ï¼š
3. åœ¨ `draft_provider.py` ä¸­æ·»åŠ  `ComfyUIProvider`ï¼Œä¸ Mock/FLUX å¹¶å­˜
4. ComfyUI å·¥ä½œæµï¼štxt2img â†’ IP-Adapter â†’ ControlNet inpaint

**Phase B â€” Scout å¢å¼º**ï¼š
5. åœ¨ `scout_service.py` ä¸­æ·»åŠ  CLIP + FAISS æ£€ç´¢ï¼Œä¿ç•™ Jaccard/æœ¯è¯­/ç¦åŒºä½œä¸º deterministic safety å±‚
6. æ„å»º VULCA-Bench æ ·æœ¬å‘é‡ç´¢å¼•

**Phase B' â€” Agent åŸºç¡€è®¾æ–½ï¼ˆâ³ è¿›è¡Œä¸­ï¼‰**ï¼š
7. âœ… `agents/layer_state.py` â€” LayerState çŠ¶æ€æœº + IntentCardV2 + CrossLayerSignal + LocalRerunRequest
8. âœ… `agents/tool_registry.py` â€” ToolRegistry + 5 Critic å·¥å…· schema/executor
9. âœ… `agents/model_router.py` â€” ModelRouter + 4 æ¨¡å‹ + Fallback Chain
10. âœ… `agents/agent_runtime.py` â€” AgentRuntime ReAct å¾ªç¯ + LiteLLM è°ƒç”¨éª¨æ¶
11. âœ… `agents/queen_types.py` â€” PlanState v2ï¼ˆlayer_statesï¼‰+ BudgetState v2ï¼ˆllm_calls/tool_callsï¼‰
12. â³ å¾…å®Œæˆï¼š`agents/critic_llm.py` + Orchestrator ä¸»é“¾æ¥çº¿ + LLM å·¥å…·è°ƒç”¨é—­ç¯éªŒè¯

**Phase C â€” Critic ReAct Agent å‡çº§**ï¼š
12. **æ–°å¢ `agents/critic_llm.py`** â€” AgentRuntime â†” Orchestrator æ¡¥æ¥å±‚ï¼ˆFC æ¶æ„æ–‡æ¡£ Â§3.1ï¼‰
13. ä¿ç•™ `CriticRules` åšç¡¬é—¨ç¦ï¼ˆtaboo + åŸºç¡€è§„èŒƒï¼‰ï¼Œ`critic_llm.py` åˆ¤æ–­é€‰æ‹©æ€§å‡çº§
14. **æ¸è¿›æ·±åŒ–**ï¼šCritic L1â†’L2â†’...â†’L5 ä¸²è¡Œ AgentRuntime.evaluate() + è·¨å±‚ read_layer_analysis
15. **é€‰æ‹©æ€§å‡çº§**ï¼šåŸºäº LayerState.priority() å†³å®šæ˜¯å¦è§¦å‘ Agent
16. **åŠ¨æ€æƒé‡**ï¼š`compute_budget_allocation()` æŒ‰å±‚å€¾æ–œèµ„æº
17. æˆæœ¬æŠ¤æ ï¼šModelRouter.budget_remaining_usd å®æ—¶æ‰£å‡
18. **éªŒè¯è„šæœ¬**ï¼š`validate_critic_llm.py` + Agent-ness å››é¡¹æŒ‡æ ‡è¾“å‡ºï¼ˆFC æ¶æ„æ–‡æ¡£ Â§6ï¼‰

**Phase D â€” è·¯ç”± + å°ç‰ˆ**ï¼š
18. å¡«å…… `cultural_pipelines/` ç›®å½•ï¼ŒQueen æ ¹æ® tradition é€‰æ‹©ç®¡é“å˜ä½“
19. å…¨é‡å›å½’ + Langfuse è§‚æµ‹

**ä¸åŠ¨çš„éƒ¨åˆ†**ï¼š
- PipelineOrchestrator çš„ run_sync/run_stream æ¥å£
- HITL çš„ 5 ä¸ªåŠ¨ä½œè¯­ä¹‰
- å‰ç«¯ PrototypePage æ•´ä½“ç»“æ„
- API çš„ 4 ä¸ªç«¯ç‚¹
- Checkpoint å­˜å‚¨æ ¼å¼
- Together FLUX å·²éªŒè¯çš„ provider å®ç°
- CriticAgent è§„åˆ™æ‰“åˆ†é€»è¾‘ï¼ˆä½œä¸º Agent å±‚çš„ fallbackï¼‰
- QueenAgent 8 çº§å†³ç­–æ ‘ï¼ˆä¿ç•™ï¼Œæœªæ¥å¯å‡çº§ä¸º LLM Agentï¼‰

---

## é™„å½• Aï¼šv1 â†’ v2 å®Œæ•´å¯¹ç…§ï¼ˆv2.2 æ›´æ–°ï¼‰

| ç»´åº¦ | v1 è®¡åˆ’ | v1 å®é™…ï¼ˆå« Step 2ï¼‰ | v2.2 ç›®æ ‡ |
|------|---------|---------------------|---------|
| **Critic æ¶æ„** | DeepEval G-Eval | è§„åˆ™æ‰“åˆ†ï¼ˆ`if term_count > 3: +0.1`ï¼‰ | **ReAct Agent**ï¼šLLM è‡ªä¸»è°ƒå·¥å…· â†’ submit_evaluation |
| **Critic æ¨¡å‹** | Claude Sonnet ($0.02) | æ—  LLMï¼ˆ0 æ¬¡è°ƒç”¨ï¼‰ | **DeepSeek V3.2** ($0.002) + **Gemini Flash-Lite** ($0.001) |
| **Agent çœŸå®æ€§** | "5 Agent å›¢é˜Ÿ" | 5 ä¸ªç¡¬ç¼–ç  Python è„šæœ¬ï¼ˆ0 LLM/0 Toolï¼‰ | Critic å‡çº§ä¸ºçœŸ Agentï¼Œå…¶ä½™æ¸è¿›å‡çº§ |
| Draft ç”Ÿæˆ | SD 1.5 æœ¬åœ° | Mock + **FLUX çœŸå®æ”¾é‡**ï¼ˆ320 tasks, 90% passï¼‰ | ComfyUI SD 1.5 + ControlNet + FLUX |
| å±€éƒ¨é‡ç»˜ | ControlNet + Checkpoint | åˆ†æ•°ä¿ç•™ + å…¨é‡æ–°å›¾å†ç”Ÿ | ComfyUI inpaint + mask åƒç´ çº§å±€éƒ¨ä¿®æ”¹ |
| Scout æ£€ç´¢ | FAISS/LanceDB | æœ¯è¯­+ç¦åŒº+æ ·æœ¬åŒ¹é…ï¼ˆJaccard/tagï¼‰ | CLIP + FAISS å‘é‡è¯­ä¹‰æ£€ç´¢ï¼ˆä¿ç•™è§„åˆ™å±‚ï¼‰ |
| æ–‡åŒ–è·¯ç”± | 3 æ¡å˜ä½“ | ä»… `tradition` å‚æ•°ä¼ é€’ | 3 æ¡å˜ä½“ï¼ˆæƒé‡+æµç¨‹å·®å¼‚åŒ–ï¼‰ |
| **LLM è·¯ç”±** | LiteLLM | è‡ªç ” FallbackProvider | **LiteLLM + ModelRouter** + Fallback Chainï¼ˆå·²å®ç°ï¼‰ |
| è§‚æµ‹ | Langfuse | æ‰‹åŠ¨ç»Ÿè®¡ | Langfuse + AgentResult æˆæœ¬è¿½è¸ª |
| Agent æ¡†æ¶ | CrewAI Flows | è‡ªç ” PipelineOrchestratorï¼ˆå¯ç”¨ï¼‰ | ä¿ç•™ Orchestrator + **AgentRuntime** å­ Agent |
| L1-L5 é›†æˆ | å…¨é“¾è·¯é©±åŠ¨ | ä»… Critic 5 ç»´åº¦è¯„åˆ† | **åŠ¨æ€è®¤çŸ¥å¼•æ“**ï¼šLayerState + CrossLayerSignal + åŠ¨æ€æƒé‡ + æ¸è¿›æ·±åŒ– |
| **å•æ ·ä¾‹æˆæœ¬** | ~$0.10 | $0.0132ï¼ˆä»… FLUXï¼‰ | **$0.008**ï¼ˆæ··åˆæ¨¡å¼ï¼‰/ $0.004ï¼ˆé€‰æ‹©æ€§å‡çº§ï¼‰ |
| **æ—¥é¢„ç®—è¦†ç›–** | ~50 æ¬¡ | â€” | **500-1250 æ¬¡** |

## é™„å½• Bï¼šå­¦æœ¯å‚è€ƒï¼ˆv1 ä¿ç•™ + v2 æ–°å¢ï¼‰

### v1 ä¿ç•™
- Feldman å››æ­¥æ‰¹è¯„æ³• (Descriptionâ†’Analysisâ†’Interpretationâ†’Judgment)
- Panofsky å›¾åƒå­¦ä¸‰å±‚ (Pre-Iconographicâ†’Iconographicâ†’Iconological)
- RefineBench arXiv:2511.22173ï¼ˆLLM è‡ªçº åä»… +1.8%ï¼Œéœ€å¤–éƒ¨é”šå®šï¼‰
- ReAgent arXiv:2503.06951ï¼ˆEMNLP 2025ï¼Œå¯é€†æ¨ç†ï¼‰
- SagaLLM arXiv:2503.11951ï¼ˆVLDB 2025ï¼ŒSaga äº‹åŠ¡è¡¥å¿ï¼‰

### v2 æ–°å¢
- VULCA Frameworkï¼ˆEMNLP 2025 Findingsï¼ŒYu et al. â€” äº”ç»´åº¦è¯„æµ‹æ¡†æ¶ï¼‰
- VULCA-Bench arXiv:2601.07986ï¼ˆYu et al. â€” L1-L5 äº”å±‚å®šä¹‰ + 7,410 æ ·æœ¬ï¼‰
- GalleryGPTï¼ˆACM MM 2024 Oral â€” ç»˜ç”»è§†è§‰åˆ†æä¸“ç”¨æ¨¡å‹ï¼‰
- DeepEval G-Evalï¼ˆLLM-as-judge ç»“æ„åŒ– rubric è¯„åˆ†æ¡†æ¶ï¼‰
- IP-Adapterï¼ˆhttps://github.com/tencent-ailab/IP-Adapter â€” é£æ ¼è¿ç§»ï¼‰
- ControlNet arXiv:2302.05543ï¼ˆæ¡ä»¶æ§åˆ¶ç”Ÿæˆï¼‰
- CLIPï¼ˆOpenAI â€” è§†è§‰-æ–‡æœ¬å¯¹é½åµŒå…¥ï¼‰

### v2 åŠ¨æ€èåˆç›¸å…³ï¼ˆè¯¦è§ `vulca-l1l5-dynamic-fusion-design.md` Â§8ï¼‰
- Multi-agent collaborative pathways for Chinese traditional architectureï¼ˆNature Sci Reports, 2025 â€” ç»“æ„åŒ– error flags + æ ¹å› è¯Šæ–­ï¼‰
- MAJ-EVAL: Agent-as-a-Judgeï¼ˆ2025 â€” å¤šç»´åº¦ persona äº¤å‰è®¨è®ºï¼‰
- Multi-Task Dynamic Weight Optimization Based on DRLï¼ˆMDPI Applied Sciences, 2025 â€” Actor-Critic åœ¨çº¿æƒé‡å­¦ä¹ ï¼‰
- LFMDiff: Chinese traditional landscape painting generationï¼ˆnpj Heritage Science, 2025 â€” åŠ¨æ€ rank/alphaï¼‰
- Panofsky, E. (1939). Studies in Iconologyï¼ˆå±‚çº§è®¤çŸ¥ä¾èµ–çš„ç†è®ºåŸºç¡€ï¼‰
- Feldman, E.B. (1994). Practical Art Criticismï¼ˆå››æ­¥æ‰¹è¯„æ³•çš„æ¸è¿›æ·±åŒ–ï¼‰
